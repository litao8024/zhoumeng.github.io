<!DOCTYPE html>
<!-- saved from url=(0030)/ -->
<html lang="zh" class="js json svg checked target dataset details fetch supports csstransforms3d no-ios" style=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
      
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="/">
      
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="ja">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="./index_files/AI.jpg">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-4.4.0">
    
    
      
        <title>第二章:迁移学习 - 迁移学习</title>
      
    
    
      <link rel="stylesheet" href="./index_files/application.0284f74d.css">
      
      
    
    
      <script src="./index_files/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin="">
        <link rel="stylesheet" href="./index_files/css">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="./index_files/material-icons.css">
    
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-36723568-3", "mkdocs.org")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async="" src="./index_files/analytics.js"></script>
      
    
    
  <script type="text/javascript">(function(){var s=document.createElement("script");var port=window.location.port;s.src="//"+window.location.hostname+":"+port+ "/livereload.js?port=" + port;document.head.appendChild(s);})();</script><script src="./index_files/livereload.js"></script></head>
  
    <body dir="ltr" data-md-state="">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#21" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header" data-md-state="shadow">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="./index.html" title="迁移学习" class="md-header-nav__button md-logo">
          
            <img src="./index_files/AI.jpg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic" style="width: 648px;">
              迁移学习
            </span>
            <span class="md-header-nav__topic" style="width: 648px;">
              
                第二章:迁移学习
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix="">
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="http://www.itcast.cn/" title="前往 Github 仓库" class="md-source" data-md-source="" data-md-state="done">
  
  <div class="md-source__repository">
    「传智播客: 用爱成就每一位学生」
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" style="height: 637px;">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="./index.html" title="迁移学习" class="md-nav__button md-logo">
      
        <img src="./index_files/AI.jpg" width="48" height="48">
      
    </a>
    迁移学习
  </label>
  
    <div class="md-nav__source">
      


  

<a href="http://www.itcast.cn/" title="前往 Github 仓库" class="md-source" data-md-source="" data-md-state="done">
  
  <div class="md-source__repository">
    「传智播客: 用爱成就每一位学生」
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix="">
    
      
      
      


  <li class="md-nav__item">
    <a href="./index.html" title="第一章:fasttext工具的使用" class="md-nav__link">
      第一章:fasttext工具的使用
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        第二章:迁移学习
      </label>
    
    <a href="/" title="第二章:迁移学习" class="md-nav__link md-nav__link--active">
      第二章:迁移学习
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix="">
      
        <li class="md-nav__item">
  <a href="#21" title="2.1 迁移学习理论" class="md-nav__link">
    2.1 迁移学习理论
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" title="学习目标" class="md-nav__link">
    学习目标
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#22-nlp" title="2.2 NLP中的标准数据集" class="md-nav__link">
    2.2 NLP中的标准数据集
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" title="学习目标" class="md-nav__link">
    学习目标
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#glue" title="GLUE数据集合包含以下数据集" class="md-nav__link">
    GLUE数据集合包含以下数据集
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#glue_1" title="GLUE数据集合中子数据集的样式及其任务类型" class="md-nav__link">
    GLUE数据集合中子数据集的样式及其任务类型
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cola" title="CoLA数据集文件样式" class="md-nav__link">
    CoLA数据集文件样式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sst-2" title="SST-2数据集文件样式" class="md-nav__link">
    SST-2数据集文件样式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mrpc" title="MRPC数据集文件样式" class="md-nav__link">
    MRPC数据集文件样式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sts-b" title="STS-B数据集文件样式" class="md-nav__link">
    STS-B数据集文件样式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qqp" title="QQP数据集文件样式" class="md-nav__link">
    QQP数据集文件样式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mnlisnli" title="(MNLI/SNLI)数据集文件样式" class="md-nav__link">
    (MNLI/SNLI)数据集文件样式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qnlirtewnli" title="(QNLI/RTE/WNLI)数据集文件样式" class="md-nav__link">
    (QNLI/RTE/WNLI)数据集文件样式
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="小节总结" class="md-nav__link">
    小节总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#23-nlp" title="2.3 NLP中的常用预训练模型" class="md-nav__link">
    2.3 NLP中的常用预训练模型
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" title="学习目标" class="md-nav__link">
    学习目标
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nlp" title="当下NLP中流行的预训练模型" class="md-nav__link">
    当下NLP中流行的预训练模型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" title="小节总结" class="md-nav__link">
    小节总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#24" title="2.4 加载和使用预训练模型" class="md-nav__link">
    2.4 加载和使用预训练模型
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" title="学习目标" class="md-nav__link">
    学习目标
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" title="加载和使用预训练模型的工具" class="md-nav__link">
    加载和使用预训练模型的工具
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" title="加载和使用预训练模型的步骤" class="md-nav__link">
    加载和使用预训练模型的步骤
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" title="第一步: 确定需要加载的预训练模型并安装依赖包" class="md-nav__link">
    第一步: 确定需要加载的预训练模型并安装依赖包
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tokenizer" title="第二步: 加载预训练模型的映射器tokenizer" class="md-nav__link">
    第二步: 加载预训练模型的映射器tokenizer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" title="第三步: 加载带/不带头的预训练模型" class="md-nav__link">
    第三步: 加载带/不带头的预训练模型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" title="第四步: 使用模型获得输出结果" class="md-nav__link">
    第四步: 使用模型获得输出结果
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" title="小节总结" class="md-nav__link">
    小节总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#25" title="2.5 迁移学习实践" class="md-nav__link">
    2.5 迁移学习实践
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" title="学习目标" class="md-nav__link">
    学习目标
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" title="指定任务类型的微调脚本使用步骤" class="md-nav__link">
    指定任务类型的微调脚本使用步骤
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" title="第一步: 下载微调脚本文件" class="md-nav__link">
    第一步: 下载微调脚本文件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" title="第二步: 配置微调脚本参数" class="md-nav__link">
    第二步: 配置微调脚本参数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" title="第三步: 运行并检验效果" class="md-nav__link">
    第三步: 运行并检验效果
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" title="通过微调脚本微调后模型的使用步骤" class="md-nav__link">
    通过微调脚本微调后模型的使用步骤
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#httpshuggingfacecojoin" title="第一步: 在https://huggingface.co/join上创建一个帐户" class="md-nav__link">
    第一步: 在https://huggingface.co/join上创建一个帐户
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transformers-cli" title="第二步: 在服务器终端使用transformers-cli登陆" class="md-nav__link">
    第二步: 在服务器终端使用transformers-cli登陆
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transformers-cli_1" title="第三步: 使用transformers-cli上传模型并查看" class="md-nav__link">
    第三步: 使用transformers-cli上传模型并查看
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pytorchhub-24" title="第四步: 使用pytorch.hub加载模型进行使用, 更多信息请参考2.4 加载和使用预训练模型" class="md-nav__link">
    第四步: 使用pytorch.hub加载模型进行使用, 更多信息请参考2.4 加载和使用预训练模型
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" title="通过微调方式进行迁移学习的两种类型" class="md-nav__link">
    通过微调方式进行迁移学习的两种类型
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_20" title="类型一实战演示" class="md-nav__link">
    类型一实战演示
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" title="类型二实战演示" class="md-nav__link">
    类型二实战演示
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" title="小节总结" class="md-nav__link">
    小节总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" style="height: 637px;">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix="">
      
        <li class="md-nav__item">
  <a href="#21" title="2.1 迁移学习理论" class="md-nav__link">
    2.1 迁移学习理论
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" title="学习目标" class="md-nav__link">
    学习目标
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#22-nlp" title="2.2 NLP中的标准数据集" class="md-nav__link">
    2.2 NLP中的标准数据集
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" title="学习目标" class="md-nav__link">
    学习目标
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#glue" title="GLUE数据集合包含以下数据集" class="md-nav__link">
    GLUE数据集合包含以下数据集
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#glue_1" title="GLUE数据集合中子数据集的样式及其任务类型" class="md-nav__link">
    GLUE数据集合中子数据集的样式及其任务类型
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cola" title="CoLA数据集文件样式" class="md-nav__link">
    CoLA数据集文件样式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sst-2" title="SST-2数据集文件样式" class="md-nav__link">
    SST-2数据集文件样式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mrpc" title="MRPC数据集文件样式" class="md-nav__link">
    MRPC数据集文件样式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sts-b" title="STS-B数据集文件样式" class="md-nav__link">
    STS-B数据集文件样式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qqp" title="QQP数据集文件样式" class="md-nav__link">
    QQP数据集文件样式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mnlisnli" title="(MNLI/SNLI)数据集文件样式" class="md-nav__link">
    (MNLI/SNLI)数据集文件样式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qnlirtewnli" title="(QNLI/RTE/WNLI)数据集文件样式" class="md-nav__link">
    (QNLI/RTE/WNLI)数据集文件样式
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="小节总结" class="md-nav__link">
    小节总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#23-nlp" title="2.3 NLP中的常用预训练模型" class="md-nav__link">
    2.3 NLP中的常用预训练模型
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" title="学习目标" class="md-nav__link">
    学习目标
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nlp" title="当下NLP中流行的预训练模型" class="md-nav__link">
    当下NLP中流行的预训练模型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" title="小节总结" class="md-nav__link">
    小节总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#24" title="2.4 加载和使用预训练模型" class="md-nav__link">
    2.4 加载和使用预训练模型
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" title="学习目标" class="md-nav__link">
    学习目标
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" title="加载和使用预训练模型的工具" class="md-nav__link">
    加载和使用预训练模型的工具
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" title="加载和使用预训练模型的步骤" class="md-nav__link">
    加载和使用预训练模型的步骤
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" title="第一步: 确定需要加载的预训练模型并安装依赖包" class="md-nav__link">
    第一步: 确定需要加载的预训练模型并安装依赖包
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tokenizer" title="第二步: 加载预训练模型的映射器tokenizer" class="md-nav__link">
    第二步: 加载预训练模型的映射器tokenizer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" title="第三步: 加载带/不带头的预训练模型" class="md-nav__link">
    第三步: 加载带/不带头的预训练模型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" title="第四步: 使用模型获得输出结果" class="md-nav__link">
    第四步: 使用模型获得输出结果
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" title="小节总结" class="md-nav__link">
    小节总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#25" title="2.5 迁移学习实践" class="md-nav__link">
    2.5 迁移学习实践
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" title="学习目标" class="md-nav__link">
    学习目标
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" title="指定任务类型的微调脚本使用步骤" class="md-nav__link">
    指定任务类型的微调脚本使用步骤
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" title="第一步: 下载微调脚本文件" class="md-nav__link">
    第一步: 下载微调脚本文件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" title="第二步: 配置微调脚本参数" class="md-nav__link">
    第二步: 配置微调脚本参数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" title="第三步: 运行并检验效果" class="md-nav__link">
    第三步: 运行并检验效果
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" title="通过微调脚本微调后模型的使用步骤" class="md-nav__link">
    通过微调脚本微调后模型的使用步骤
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#httpshuggingfacecojoin" title="第一步: 在https://huggingface.co/join上创建一个帐户" class="md-nav__link">
    第一步: 在https://huggingface.co/join上创建一个帐户
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transformers-cli" title="第二步: 在服务器终端使用transformers-cli登陆" class="md-nav__link">
    第二步: 在服务器终端使用transformers-cli登陆
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transformers-cli_1" title="第三步: 使用transformers-cli上传模型并查看" class="md-nav__link">
    第三步: 使用transformers-cli上传模型并查看
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pytorchhub-24" title="第四步: 使用pytorch.hub加载模型进行使用, 更多信息请参考2.4 加载和使用预训练模型" class="md-nav__link">
    第四步: 使用pytorch.hub加载模型进行使用, 更多信息请参考2.4 加载和使用预训练模型
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" title="通过微调方式进行迁移学习的两种类型" class="md-nav__link">
    通过微调方式进行迁移学习的两种类型
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_20" title="类型一实战演示" class="md-nav__link">
    类型一实战演示
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" title="类型二实战演示" class="md-nav__link">
    类型二实战演示
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" title="小节总结" class="md-nav__link">
    小节总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>第二章:迁移学习</h1>
                
                <h2 id="21">2.1 迁移学习理论</h2>
<hr>
<h3 id="_1">学习目标</h3>
<ul>
<li>了解迁移学习中的有关概念.</li>
<li>掌握迁移学习的两种迁移方式.</li>
</ul>
<hr>
<ul>
<li>迁移学习中的有关概念:<ul>
<li>预训练模型</li>
<li>微调</li>
<li>微调脚本</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>预训练模型(Pretrained model):<ul>
<li>一般情况下预训练模型都是大型模型，具备复杂的网络结构，众多的参数量，以及在足够大的数据集下进行训练而产生的模型. 在NLP领域，预训练模型往往是语言模型，因为语言模型的训练是无监督的，可以获得大规模语料，同时语言模型又是许多典型NLP任务的基础，如机器翻译，文本生成，阅读理解等，常见的预训练模型有BERT, GPT, roBERTa, transformer-XL等.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>微调(Fine-tuning):<ul>
<li>根据给定的预训练模型，改变它的部分参数或者为其新增部分输出结构后，通过在小部分数据集上训练，来使整个模型更好的适应特定任务.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>微调脚本(Fine-tuning script):<ul>
<li>实现微调过程的代码文件。这些脚本文件中，应包括对预训练模型的调用，对微调参数的选定以及对微调结构的更改等，同时，因为微调是一个训练过程，它同样需要一些超参数的设定，以及损失函数和优化器的选取等, 因此微调脚本往往也包含了整个迁移学习的过程.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>关于微调脚本的说明:<ul>
<li>一般情况下，微调脚本应该由不同的任务类型开发者自己编写，但是由于目前研究的NLP任务类型（分类，提取，生成）以及对应的微调输出结构都是有限的，有些微调方式已经在很多数据集上被验证是有效的，因此微调脚本也可以使用已经完成的规范脚本.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>两种迁移方式:<ul>
<li>直接使用预训练模型，进行相同任务的处理，不需要调整参数或模型结构，这些模型开箱即用。但是这种情况一般只适用于普适任务, 如：fasttest工具包中预训练的词向量模型。另外，很多预训练模型开发者为了达到开箱即用的效果，将模型结构分各个部分保存为不同的预训练模型，提供对应的加载方法来完成特定目标.</li>
<li>更加主流的迁移学习方式是发挥预训练模型特征抽象的能力，然后再通过微调的方式，通过训练更新小部分参数以此来适应不同的任务。这种迁移方式需要提供小部分的标注数据来进行监督学习.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>关于迁移方式的说明:<ul>
<li>直接使用预训练模型的方式, 已经在fasttext的词向量迁移中学习. 接下来的迁移学习实践将主要讲解通过微调的方式进行迁移学习.</li>
</ul>
</li>
</ul>
<hr>
<h2 id="22-nlp">2.2 NLP中的标准数据集</h2>
<hr>
<h3 id="_2">学习目标</h3>
<ul>
<li>了解NLP中GLUE标准数据集合的相关知识.</li>
<li>掌握GLUE标准数据集合的下载方式, 数据样式及其对应的任务类型.</li>
</ul>
<hr>
<ul>
<li>GLUE数据集合的介绍:<ul>
<li>GLUE由纽约大学, 华盛顿大学, Google联合推出, 涵盖不同NLP任务类型, 截止至2020年1月其中包括11个子任务数据集, 成为衡量NLP研究发展的衡量标准. </li>
</ul>
</li>
</ul>
<hr>
<h3 id="glue">GLUE数据集合包含以下数据集</h3>
<ul>
<li>CoLA 数据集</li>
<li>SST-2 数据集</li>
<li>MRPC 数据集</li>
<li>STS-B 数据集</li>
<li>QQP 数据集</li>
<li>MNLI 数据集</li>
<li>SNLI 数据集</li>
<li>QNLI 数据集</li>
<li>RTE 数据集</li>
<li>WNLI 数据集</li>
<li>diagnostics数据集(官方未完善)</li>
</ul>
<hr>
<ul>
<li>GLUE数据集合的下载方式:</li>
</ul>
<blockquote>
<ul>
<li>下载脚本代码:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_0"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_0 pre, #__code_0 code"><span class="md-clipboard__message"></span></button><pre id="__code_1"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_1 pre, #__code_1 code"><span class="md-clipboard__message"></span></button><code><span class="sd">''' Script for downloading all GLUE data.'''</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">zipfile</span>

<span class="n">TASKS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"CoLA"</span><span class="p">,</span> <span class="s2">"SST"</span><span class="p">,</span> <span class="s2">"MRPC"</span><span class="p">,</span> <span class="s2">"QQP"</span><span class="p">,</span> <span class="s2">"STS"</span><span class="p">,</span> <span class="s2">"MNLI"</span><span class="p">,</span> <span class="s2">"SNLI"</span><span class="p">,</span> <span class="s2">"QNLI"</span><span class="p">,</span> <span class="s2">"RTE"</span><span class="p">,</span> <span class="s2">"WNLI"</span><span class="p">,</span> <span class="s2">"diagnostic"</span><span class="p">]</span>
<span class="n">TASK2PATH</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"CoLA"</span><span class="p">:</span><span class="s1">'https://firebasestorage.googleapis.com/v0/b/mtl-sentence-representations.appspot.com/o/data</span><span class="si">%2F</span><span class="s1">CoLA.zip?alt=media&amp;token=46d5e637-3411-4188-bc44-5809b5bfb5f4'</span><span class="p">,</span>
             <span class="s2">"SST"</span><span class="p">:</span><span class="s1">'https://firebasestorage.googleapis.com/v0/b/mtl-sentence-representations.appspot.com/o/data</span><span class="si">%2F</span><span class="s1">SST-2.zip?alt=media&amp;token=aabc5f6b-e466-44a2-b9b4-cf6337f84ac8'</span><span class="p">,</span>
             <span class="s2">"MRPC"</span><span class="p">:</span><span class="s1">'https://firebasestorage.googleapis.com/v0/b/mtl-sentence-representations.appspot.com/o/data</span><span class="si">%2F</span><span class="s1">mrpc_dev_ids.tsv?alt=media&amp;token=ec5c0836-31d5-48f4-b431-7480817f1adc'</span><span class="p">,</span>
             <span class="s2">"QQP"</span><span class="p">:</span><span class="s1">'https://firebasestorage.googleapis.com/v0/b/mtl-sentence-representations.appspot.com/o/data</span><span class="si">%2F</span><span class="s1">QQP.zip?alt=media&amp;token=700c6acf-160d-4d89-81d1-de4191d02cb5'</span><span class="p">,</span>
             <span class="s2">"STS"</span><span class="p">:</span><span class="s1">'https://firebasestorage.googleapis.com/v0/b/mtl-sentence-representations.appspot.com/o/data</span><span class="si">%2F</span><span class="s1">STS-B.zip?alt=media&amp;token=bddb94a7-8706-4e0d-a694-1109e12273b5'</span><span class="p">,</span>
             <span class="s2">"MNLI"</span><span class="p">:</span><span class="s1">'https://firebasestorage.googleapis.com/v0/b/mtl-sentence-representations.appspot.com/o/data</span><span class="si">%2F</span><span class="s1">MNLI.zip?alt=media&amp;token=50329ea1-e339-40e2-809c-10c40afff3ce'</span><span class="p">,</span>
             <span class="s2">"SNLI"</span><span class="p">:</span><span class="s1">'https://firebasestorage.googleapis.com/v0/b/mtl-sentence-representations.appspot.com/o/data</span><span class="si">%2F</span><span class="s1">SNLI.zip?alt=media&amp;token=4afcfbb2-ff0c-4b2d-a09a-dbf07926f4df'</span><span class="p">,</span>
             <span class="s2">"QNLI"</span><span class="p">:</span> <span class="s1">'https://firebasestorage.googleapis.com/v0/b/mtl-sentence-representations.appspot.com/o/data</span><span class="si">%2F</span><span class="s1">QNLIv2.zip?alt=media&amp;token=6fdcf570-0fc5-4631-8456-9505272d1601'</span><span class="p">,</span>
             <span class="s2">"RTE"</span><span class="p">:</span><span class="s1">'https://firebasestorage.googleapis.com/v0/b/mtl-sentence-representations.appspot.com/o/data</span><span class="si">%2F</span><span class="s1">RTE.zip?alt=media&amp;token=5efa7e85-a0bb-4f19-8ea2-9e1840f077fb'</span><span class="p">,</span>
             <span class="s2">"WNLI"</span><span class="p">:</span><span class="s1">'https://firebasestorage.googleapis.com/v0/b/mtl-sentence-representations.appspot.com/o/data</span><span class="si">%2F</span><span class="s1">WNLI.zip?alt=media&amp;token=068ad0a0-ded7-4bd7-99a5-5e00222e0faf'</span><span class="p">,</span>
             <span class="s2">"diagnostic"</span><span class="p">:</span><span class="s1">'https://storage.googleapis.com/mtl-sentence-representations.appspot.com/tsvsWithoutLabels</span><span class="si">%2F</span><span class="s1">AX.tsv?GoogleAccessId=firebase-adminsdk-0khhl@mtl-sentence-representations.iam.gserviceaccount.com&amp;Expires=2498860800&amp;Signature=DuQ2CSPt2Yfre0C%2BiISrVYrIFaZH1Lc7hBVZDD4ZyR7fZYOMNOUGpi8QxBmTNOrNPjR3z1cggo7WXFfrgECP6FBJSsURv8Ybrue8Ypt</span><span class="si">%2F</span><span class="s1">TPxbuJ0Xc2FhDi%2BarnecCBFO77RSbfuz%2Bs95hRrYhTnByqu3U</span><span class="si">%2F</span><span class="s1">YZPaj3tZt5QdfpH2IUROY8LiBXoXS46LE</span><span class="si">%2F</span><span class="s1">gOQc</span><span class="si">%2F</span><span class="s1">KN%2BA9SoscRDYsnxHfG0IjXGwHN%2Bf88q6hOmAxeNPx6moDulUF6XMUAaXCSFU%2BnRO2RDL9CapWxj%2BDl7syNyHhB7987hZ80B</span><span class="si">%2F</span><span class="s1">wFkQ3MEs8auvt5XW1%2Bd4aCU7ytgM69r8JDCwibfhZxpaa4gd50QXQ%3D%3D'</span><span class="p">}</span>

<span class="n">MRPC_TRAIN</span> <span class="o">=</span> <span class="s1">'https://dl.fbaipublicfiles.com/senteval/senteval_data/msr_paraphrase_train.txt'</span>
<span class="n">MRPC_TEST</span> <span class="o">=</span> <span class="s1">'https://dl.fbaipublicfiles.com/senteval/senteval_data/msr_paraphrase_test.txt'</span>

<span class="k">def</span> <span class="nf">download_and_extract</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"Downloading and extracting </span><span class="si">%s</span><span class="s2">..."</span> <span class="o">%</span> <span class="n">task</span><span class="p">)</span>
    <span class="n">data_file</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%s</span><span class="s2">.zip"</span> <span class="o">%</span> <span class="n">task</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">TASK2PATH</span><span class="p">[</span><span class="n">task</span><span class="p">],</span> <span class="n">data_file</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
        <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">Completed!"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">format_mrpc</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">path_to_data</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"Processing MRPC..."</span><span class="p">)</span>
    <span class="n">mrpc_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">"MRPC"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">mrpc_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">mrpc_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">path_to_data</span><span class="p">:</span>
        <span class="n">mrpc_train_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_data</span><span class="p">,</span> <span class="s2">"msr_paraphrase_train.txt"</span><span class="p">)</span>
        <span class="n">mrpc_test_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_data</span><span class="p">,</span> <span class="s2">"msr_paraphrase_test.txt"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">"Local MRPC data not specified, downloading data from </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">MRPC_TRAIN</span><span class="p">)</span>
        <span class="n">mrpc_train_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mrpc_dir</span><span class="p">,</span> <span class="s2">"msr_paraphrase_train.txt"</span><span class="p">)</span>
        <span class="n">mrpc_test_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mrpc_dir</span><span class="p">,</span> <span class="s2">"msr_paraphrase_test.txt"</span><span class="p">)</span>
        <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">MRPC_TRAIN</span><span class="p">,</span> <span class="n">mrpc_train_file</span><span class="p">)</span>
        <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">MRPC_TEST</span><span class="p">,</span> <span class="n">mrpc_test_file</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">mrpc_train_file</span><span class="p">),</span> <span class="s2">"Train data not found at </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">mrpc_train_file</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">mrpc_test_file</span><span class="p">),</span> <span class="s2">"Test data not found at </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">mrpc_test_file</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">TASK2PATH</span><span class="p">[</span><span class="s2">"MRPC"</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mrpc_dir</span><span class="p">,</span> <span class="s2">"dev_ids.tsv"</span><span class="p">))</span>

    <span class="n">dev_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mrpc_dir</span><span class="p">,</span> <span class="s2">"dev_ids.tsv"</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf8"</span><span class="p">)</span> <span class="k">as</span> <span class="n">ids_fh</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">ids_fh</span><span class="p">:</span>
            <span class="n">dev_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\t</span><span class="s1">'</span><span class="p">))</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mrpc_train_file</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf8"</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_fh</span><span class="p">,</span> \
         <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mrpc_dir</span><span class="p">,</span> <span class="s2">"train.tsv"</span><span class="p">),</span> <span class="s1">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf8"</span><span class="p">)</span> <span class="k">as</span> <span class="n">train_fh</span><span class="p">,</span> \
         <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mrpc_dir</span><span class="p">,</span> <span class="s2">"dev.tsv"</span><span class="p">),</span> <span class="s1">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf8"</span><span class="p">)</span> <span class="k">as</span> <span class="n">dev_fh</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">data_fh</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">train_fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="n">dev_fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data_fh</span><span class="p">:</span>
            <span class="n">label</span><span class="p">,</span> <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\t</span><span class="s1">'</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">[</span><span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dev_ids</span><span class="p">:</span>
                <span class="n">dev_fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">train_fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">))</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mrpc_test_file</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf8"</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_fh</span><span class="p">,</span> \
            <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mrpc_dir</span><span class="p">,</span> <span class="s2">"test.tsv"</span><span class="p">),</span> <span class="s1">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf8"</span><span class="p">)</span> <span class="k">as</span> <span class="n">test_fh</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">data_fh</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">test_fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"index</span><span class="se">\t</span><span class="s2">#1 ID</span><span class="se">\t</span><span class="s2">#2 ID</span><span class="se">\t</span><span class="s2">#1 String</span><span class="se">\t</span><span class="s2">#2 String</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_fh</span><span class="p">):</span>
            <span class="n">label</span><span class="p">,</span> <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\t</span><span class="s1">'</span><span class="p">)</span>
            <span class="n">test_fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"</span><span class="si">%d</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">Completed!"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">download_diagnostic</span><span class="p">(</span><span class="n">data_dir</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"Downloading and extracting diagnostic..."</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">"diagnostic"</span><span class="p">)):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">"diagnostic"</span><span class="p">))</span>
    <span class="n">data_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">"diagnostic"</span><span class="p">,</span> <span class="s2">"diagnostic.tsv"</span><span class="p">)</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">TASK2PATH</span><span class="p">[</span><span class="s2">"diagnostic"</span><span class="p">],</span> <span class="n">data_file</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">Completed!"</span><span class="p">)</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">get_tasks</span><span class="p">(</span><span class="n">task_names</span><span class="p">):</span>
    <span class="n">task_names</span> <span class="o">=</span> <span class="n">task_names</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">','</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">"all"</span> <span class="ow">in</span> <span class="n">task_names</span><span class="p">:</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="n">TASKS</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">task_name</span> <span class="ow">in</span> <span class="n">task_names</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">task_name</span> <span class="ow">in</span> <span class="n">TASKS</span><span class="p">,</span> <span class="s2">"Task </span><span class="si">%s</span><span class="s2"> not found!"</span> <span class="o">%</span> <span class="n">task_name</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tasks</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--data_dir'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">'directory to save data to'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">'glue_data'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--tasks'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">'tasks to download data for as a comma separated string'</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">'all'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--path_to_mrpc'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">'path to directory containing extracted MRPC data, msr_paraphrase_train.txt and msr_paraphrase_text.txt'</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">data_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">data_dir</span><span class="p">)</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="n">get_tasks</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">tasks</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">task</span> <span class="o">==</span> <span class="s1">'MRPC'</span><span class="p">:</span>
            <span class="n">format_mrpc</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">path_to_mrpc</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">task</span> <span class="o">==</span> <span class="s1">'diagnostic'</span><span class="p">:</span>
            <span class="n">download_diagnostic</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">data_dir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">download_and_extract</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">data_dir</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>运行脚本下载所有数据集:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_2"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_2 pre, #__code_2 code"><span class="md-clipboard__message"></span></button><pre id="__code_3"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_3 pre, #__code_3 code"><span class="md-clipboard__message"></span></button><code><span class="c1"># 假设你已经将以上代码copy到download_glue_data.py文件中</span>
<span class="c1"># 运行这个python脚本, 你将同目录下得到一个glue文件夹</span>
python download_glue_data.py
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>输出效果:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_4"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_4 pre, #__code_4 code"><span class="md-clipboard__message"></span></button><pre id="__code_5"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_5 pre, #__code_5 code"><span class="md-clipboard__message"></span></button><code>Downloading and extracting CoLA...
    Completed!
Downloading and extracting SST...
    Completed!
Processing MRPC...
Local MRPC data not specified, downloading data from https://dl.fbaipublicfiles.com/senteval/senteval_data/msr_paraphrase_train.txt
    Completed!
Downloading and extracting QQP...
    Completed!
Downloading and extracting STS...
    Completed!
Downloading and extracting MNLI...
    Completed!
Downloading and extracting SNLI...
    Completed!
Downloading and extracting QNLI...
    Completed!
Downloading and extracting RTE...
    Completed!
Downloading and extracting WNLI...
    Completed!
Downloading and extracting diagnostic...
    Completed!
</code></pre></div>


<hr>
<h3 id="glue_1">GLUE数据集合中子数据集的样式及其任务类型</h3>
<h4 id="cola">CoLA数据集文件样式</h4>
<div class="codehilite" id="__code_6"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_6 pre, #__code_6 code"><span class="md-clipboard__message"></span></button><pre id="__code_7"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_7 pre, #__code_7 code"><span class="md-clipboard__message"></span></button><code><span class="o">-</span> <span class="n">CoLA</span><span class="o">/</span>
    <span class="o">-</span> <span class="n">dev</span><span class="p">.</span><span class="n">tsv</span>  
    <span class="o">-</span> <span class="n">original</span><span class="o">/</span>
    <span class="o">-</span> <span class="n">test</span><span class="p">.</span><span class="n">tsv</span>  
    <span class="o">-</span> <span class="n">train</span><span class="p">.</span><span class="n">tsv</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>文件样式说明:<ul>
<li>在使用中常用到的文件是train.tsv, dev.tsv, test.tsv, 分别代表训练集, 验证集和测试集. 其中train.tsv与dev.tsv数据样式相同, 都是带有标签的数据, 其中test.tsv是不带有标签的数据. </li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>train.tsv数据样式:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_8"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_8 pre, #__code_8 code"><span class="md-clipboard__message"></span></button><pre id="__code_9"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_9 pre, #__code_9 code"><span class="md-clipboard__message"></span></button><code>...
gj04    1       She coughed herself awake as the leaf landed on her nose.
gj04    1       The worm wriggled onto the carpet.
gj04    1       The chocolate melted onto the carpet.
gj04    0   *   The ball wriggled itself loose.
gj04    1       Bill wriggled himself loose.
bc01    1       The sinking of the ship to collect the insurance was very devious.
bc01    1       The ship's sinking was very devious.
bc01    0   *   The ship's sinking to collect the insurance was very devious.
bc01    1       The testing of such drugs on oneself is too risky.
bc01    0   *   This drug's testing on oneself is too risky.
...
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>train.tsv数据样式说明: <ul>
<li>train.tsv中的数据内容共分为4列, 第一列数据, 如gj04, bc01等代表每条文本数据的来源即出版物代号;  第二列数据, 0或1, 代表每条文本数据的语法是否正确, 0代表不正确, 1代表正确; 第三列数据, '<em>', 是作者最初的正负样本标记, 与第二列意义相同, '</em>'表示不正确;
第四列即是被标注的语法使用是否正确的文本句子.</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>test.tsv数据样式:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_10"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_10 pre, #__code_10 code"><span class="md-clipboard__message"></span></button><pre id="__code_11"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_11 pre, #__code_11 code"><span class="md-clipboard__message"></span></button><code>index   sentence
0   Bill whistled past the house.
1   The car honked its way down the road.
2   Bill pushed Harry off the sofa.
3   the kittens yawned awake and played.
4   I demand that the more John eats, the more he pay.
5   If John eats more, keep your mouth shut tighter, OK?
6   His expectations are always lower than mine are.
7   The sooner you call, the more carefully I will word the letter.
8   The more timid he feels, the more people he interviews without asking questions of.
9   Once Janet left, Fred became a lot crazier.
...
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>test.tsv数据样式说明:<ul>
<li>test.tsv中的数据内容共分为2列, 第一列数据代表每条文本数据的索引;  第二列数据代表用于测试的句子.</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>CoLA数据集的任务类型:<ul>
<li>二分类任务</li>
<li>评估指标为: MCC(马修斯相关系数, 在正负样本分布十分不均衡的情况下使用的二分类评估指标)</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<h4 id="sst-2">SST-2数据集文件样式</h4>
<div class="codehilite" id="__code_12"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_12 pre, #__code_12 code"><span class="md-clipboard__message"></span></button><pre id="__code_13"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_13 pre, #__code_13 code"><span class="md-clipboard__message"></span></button><code><span class="o">-</span> <span class="n">SST</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span>
        <span class="o">-</span> <span class="n">dev</span><span class="p">.</span><span class="n">tsv</span>
        <span class="o">-</span> <span class="n">original</span><span class="o">/</span>
        <span class="o">-</span> <span class="n">test</span><span class="p">.</span><span class="n">tsv</span>
        <span class="o">-</span> <span class="n">train</span><span class="p">.</span><span class="n">tsv</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>文件样式说明:<ul>
<li>在使用中常用到的文件是train.tsv, dev.tsv, test.tsv, 分别代表训练集, 验证集和测试集. 其中train.tsv与dev.tsv数据样式相同, 都是带有标签的数据, 其中test.tsv是不带有标签的数据.</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>train.tsv数据样式:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_14"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_14 pre, #__code_14 code"><span class="md-clipboard__message"></span></button><pre id="__code_15"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_15 pre, #__code_15 code"><span class="md-clipboard__message"></span></button><code>sentence    label
hide new secretions from the parental units     0
contains no wit , only labored gags     0
that loves its characters and communicates something rather beautiful about human nature    1
remains utterly satisfied to remain the same throughout     0
on the worst revenge-of-the-nerds clichés the filmmakers could dredge up    0
that 's far too tragic to merit such superficial treatment  0
demonstrates that the director of such hollywood blockbusters as patriot games can still turn out a small , personal film with an emotional wallop .    1
of saucy    1
a depressed fifteen-year-old 's suicidal poetry     0
...
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>train.tsv数据样式说明:<ul>
<li>train.tsv中的数据内容共分为2列, 第一列数据代表具有感情色彩的评论文本;  第二列数据, 0或1, 代表每条文本数据是积极或者消极的评论, 0代表消极, 1代表积极.</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>test.tsv数据样式:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_16"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_16 pre, #__code_16 code"><span class="md-clipboard__message"></span></button><pre id="__code_17"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_17 pre, #__code_17 code"><span class="md-clipboard__message"></span></button><code>index   sentence
0   uneasy mishmash of styles and genres .
1   this film 's relationship to actual tension is the same as what christmas-tree flocking in a spray can is to actual snow : a poor -- if durable -- imitation .
2   by the end of no such thing the audience , like beatrice , has a watchful affection for the monster .
3   director rob marshall went out gunning to make a great one .
4   lathan and diggs have considerable personal charm , and their screen rapport makes the old story seem new .
5   a well-made and often lovely depiction of the mysteries of friendship .
6   none of this violates the letter of behan 's book , but missing is its spirit , its ribald , full-throated humor .
7   although it bangs a very cliched drum at times , this crowd-pleaser 's fresh dialogue , energetic music , and good-natured spunk are often infectious .
8   it is not a mass-market entertainment but an uncompromising attempt by one artist to think about another .
9   this is junk food cinema at its greasiest .
...
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>test.tsv数据样式说明:
        * test.tsv中的数据内容共分为2列, 第一列数据代表每条文本数据的索引;  第二列数据代表用于测试的句子.</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>SST-2数据集的任务类型:<ul>
<li>二分类任务</li>
<li>评估指标为: ACC</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<h4 id="mrpc">MRPC数据集文件样式</h4>
<div class="codehilite" id="__code_18"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_18 pre, #__code_18 code"><span class="md-clipboard__message"></span></button><pre id="__code_19"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_19 pre, #__code_19 code"><span class="md-clipboard__message"></span></button><code><span class="o">-</span> <span class="n">MRPC</span><span class="o">/</span>
        <span class="o">-</span> <span class="n">dev</span><span class="p">.</span><span class="n">tsv</span>
        <span class="o">-</span> <span class="n">test</span><span class="p">.</span><span class="n">tsv</span>
        <span class="o">-</span> <span class="n">train</span><span class="p">.</span><span class="n">tsv</span>
    <span class="o">-</span> <span class="n">dev_ids</span><span class="p">.</span><span class="n">tsv</span>
    <span class="o">-</span> <span class="n">msr_paraphrase_test</span><span class="p">.</span><span class="n">txt</span>
    <span class="o">-</span> <span class="n">msr_paraphrase_train</span><span class="p">.</span><span class="n">txt</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>文件样式说明:<ul>
<li>在使用中常用到的文件是train.tsv, dev.tsv, test.tsv, 分别代表训练集, 验证集和测试集. 其中train.tsv与dev.tsv数据样式相同, 都是带有标签的数据, 其中test.tsv是不带有标签的数据.</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>train.tsv数据样式:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_20"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_20 pre, #__code_20 code"><span class="md-clipboard__message"></span></button><pre id="__code_21"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_21 pre, #__code_21 code"><span class="md-clipboard__message"></span></button><code>Quality #1 ID   #2 ID   #1 String   #2 String
1   702876  702977  Amrozi accused his brother , whom he called " the witness " , of deliberately distorting his evidence . Referring to him as only " the witness " , Amrozi accused his brother of deliberately distorting his evidence .
0   2108705 2108831 Yucaipa owned Dominick 's before selling the chain to Safeway in 1998 for $ 2.5 billion .   Yucaipa bought Dominick 's in 1995 for $ 693 million and sold it to Safeway for $ 1.8 billion in 1998 .
1   1330381 1330521 They had published an advertisement on the Internet on June 10 , offering the cargo for sale , he added .   On June 10 , the ship 's owners had published an advertisement on the Internet , offering the explosives for sale .
0   3344667 3344648 Around 0335 GMT , Tab shares were up 19 cents , or 4.4 % , at A $ 4.56 , having earlier set a record high of A $ 4.57 . Tab shares jumped 20 cents , or 4.6 % , to set a record closing high at A $ 4.57 .
1   1236820 1236712 The stock rose $ 2.11 , or about 11 percent , to close Friday at $ 21.51 on the New York Stock Exchange .   PG &amp; E Corp. shares jumped $ 1.63 or 8 percent to $ 21.03 on the New York Stock Exchange on Friday .
1   738533  737951  Revenue in the first quarter of the year dropped 15 percent from the same period a year earlier .   With the scandal hanging over Stewart 's company , revenue the first quarter of the year dropped 15 percent from the same period a year earlier .
0   264589  264502  The Nasdaq had a weekly gain of 17.27 , or 1.2 percent , closing at 1,520.15 on Friday .    The tech-laced Nasdaq Composite .IXIC rallied 30.46 points , or 2.04 percent , to 1,520.15 .
1   579975  579810  The DVD-CCA then appealed to the state Supreme Court .  The DVD CCA appealed that decision to the U.S. Supreme Court .
...
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>train.tsv数据样式说明:<ul>
<li>train.tsv中的数据内容共分为5列, 第一列数据, 0或1, 代表每对句子是否具有相同的含义, 0代表含义不相同, 1代表含义相同. 第二列和第三列分别代表每对句子的id, 第四列和第五列分别具有相同/不同含义的句子对.</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>test.tsv数据样式:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_22"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_22 pre, #__code_22 code"><span class="md-clipboard__message"></span></button><pre id="__code_23"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_23 pre, #__code_23 code"><span class="md-clipboard__message"></span></button><code>index   #1 ID   #2 ID   #1 String   #2 String
0   1089874 1089925 PCCW 's chief operating officer , Mike Butcher , and Alex Arena , the chief financial officer , will report directly to Mr So . Current Chief Operating Officer Mike Butcher and Group Chief Financial Officer Alex Arena will report to So .
1   3019446 3019327 The world 's two largest automakers said their U.S. sales declined more than predicted last month as a late summer sales frenzy caused more of an industry backlash than expected . Domestic sales at both GM and No. 2 Ford Motor Co. declined more than predicted as a late summer sales frenzy prompted a larger-than-expected industry backlash .
2   1945605 1945824 According to the federal Centers for Disease Control and Prevention ( news - web sites ) , there were 19 reported cases of measles in the United States in 2002 .   The Centers for Disease Control and Prevention said there were 19 reported cases of measles in the United States in 2002 .
3   1430402 1430329 A tropical storm rapidly developed in the Gulf of Mexico Sunday and was expected to hit somewhere along the Texas or Louisiana coasts by Monday night . A tropical storm rapidly developed in the Gulf of Mexico on Sunday and could have hurricane-force winds when it hits land somewhere along the Louisiana coast Monday night .
4   3354381 3354396 The company didn 't detail the costs of the replacement and repairs .   But company officials expect the costs of the replacement work to run into the millions of dollars .
5   1390995 1391183 The settling companies would also assign their possible claims against the underwriters to the investor plaintiffs , he added . Under the agreement , the settling companies will also assign their potential claims against the underwriters to the investors , he added .
6   2201401 2201285 Air Commodore Quaife said the Hornets remained on three-minute alert throughout the operation . Air Commodore John Quaife said the security operation was unprecedented .
7   2453843 2453998 A Washington County man may have the countys first human case of West Nile virus , the health department said Friday .  The countys first and only human case of West Nile this year was confirmed by health officials on Sept . 8 .
...
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>test.tsv数据样式说明:
        * test.tsv中的数据内容共分为5列, 第一列数据代表每条文本数据的索引; 其余列的含义与train.tsv中相同.</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>MRPC数据集的任务类型:<ul>
<li>句子对二分类任务</li>
<li>评估指标为: ACC和F1</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<h4 id="sts-b">STS-B数据集文件样式</h4>
<div class="codehilite" id="__code_24"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_24 pre, #__code_24 code"><span class="md-clipboard__message"></span></button><pre id="__code_25"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_25 pre, #__code_25 code"><span class="md-clipboard__message"></span></button><code><span class="o">-</span> <span class="n">STS</span><span class="o">-</span><span class="n">B</span><span class="o">/</span>
        <span class="o">-</span> <span class="n">dev</span><span class="p">.</span><span class="n">tsv</span>
        <span class="o">-</span> <span class="n">test</span><span class="p">.</span><span class="n">tsv</span>
        <span class="o">-</span> <span class="n">train</span><span class="p">.</span><span class="n">tsv</span>
    <span class="o">-</span> <span class="n">LICENSE</span><span class="p">.</span><span class="n">txt</span>
    <span class="o">-</span> <span class="n">readme</span><span class="p">.</span><span class="n">txt</span>
    <span class="o">-</span> <span class="n">original</span><span class="o">/</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>文件样式说明:<ul>
<li>在使用中常用到的文件是train.tsv, dev.tsv, test.tsv, 分别代表训练集, 验证集和测试集. 其中train.tsv与dev.tsv数据样式相同, 都是带有标签的数据, 其中test.tsv是不带有标签的数据.</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>train.tsv数据样式:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_26"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_26 pre, #__code_26 code"><span class="md-clipboard__message"></span></button><pre id="__code_27"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_27 pre, #__code_27 code"><span class="md-clipboard__message"></span></button><code>index   genre   filename    year    old_index   source1 source2 sentence1   sentence2   score
0   main-captions   MSRvid  2012test    0001    none    none    A plane is taking off.  An air plane is taking off. 5.000
1   main-captions   MSRvid  2012test    0004    none    none    A man is playing a large flute. A man is playing a flute.   3.800
2   main-captions   MSRvid  2012test    0005    none    none    A man is spreading shreded cheese on a pizza.   A man is spreading shredded cheese on an uncooked pizza.    3.800
3   main-captions   MSRvid  2012test    0006    none    none    Three men are playing chess.Two men are playing chess.  2.600
4   main-captions   MSRvid  2012test    0009    none    none    A man is playing the cello.A man seated is playing the cello.   4.250
5   main-captions   MSRvid  2012test    0011    none    none    Some men are fighting.  Two men are fighting.   4.250
6   main-captions   MSRvid  2012test    0012    none    none    A man is smoking.   A man is skating.   0.500
7   main-captions   MSRvid  2012test    0013    none    none    The man is playing the piano.   The man is playing the guitar.  1.600
8   main-captions   MSRvid  2012test    0014    none    none    A man is playing on a guitar and singing.   A woman is playing an acoustic guitar and singing.  2.200
9   main-captions   MSRvid  2012test    0016    none    none    A person is throwing a cat on to the ceiling.   A person throws a cat on the ceiling.   5.000
...
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>train.tsv数据样式说明:<ul>
<li>train.tsv中的数据内容共分为10列, 第一列数据是数据索引; 第二列代表每对句子的来源, 如main-captions表示来自字幕; 第三列代表来源的具体保存文件名, 第四列代表出现时间(年); 第五列代表原始数据的索引; 第六列和第七列分别代表句子对原始来源; 第八列和第九列代表相似程度不同的句子对; 第十列代表句子对的相似程度由低到高, 值域范围是[0, 5].</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>test.tsv数据样式:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_28"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_28 pre, #__code_28 code"><span class="md-clipboard__message"></span></button><pre id="__code_29"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_29 pre, #__code_29 code"><span class="md-clipboard__message"></span></button><code>index   genre   filename    year    old_index   source1 source2 sentence1   sentence2
0   main-captions   MSRvid  2012test    0024    none    none    A girl is styling her hair. A girl is brushing her hair.
1   main-captions   MSRvid  2012test    0033    none    none    A group of men play soccer on the beach.    A group of boys are playing soccer on the beach.
2   main-captions   MSRvid  2012test    0045    none    none    One woman is measuring another woman's ankle.   A woman measures another woman's ankle.
3   main-captions   MSRvid  2012test    0063    none    none    A man is cutting up a cucumber. A man is slicing a cucumber.
4   main-captions   MSRvid  2012test    0066    none    none    A man is playing a harp.    A man is playing a keyboard.
5   main-captions   MSRvid  2012test    0074    none    none    A woman is cutting onions.  A woman is cutting tofu.
6   main-captions   MSRvid  2012test    0076    none    none    A man is riding an electric bicycle.    A man is riding a bicycle.
7   main-captions   MSRvid  2012test    0082    none    none    A man is playing the drums. A man is playing the guitar.
8   main-captions   MSRvid  2012test    0092    none    none    A man is playing guitar.    A lady is playing the guitar.
9   main-captions   MSRvid  2012test    0095    none    none    A man is playing a guitar.  A man is playing a trumpet.
10  main-captions   MSRvid  2012test    0096    none    none    A man is playing a guitar.  A man is playing a trumpet.
...
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>test.tsv数据样式说明:<ul>
<li>test.tsv中的数据内容共分为9列, 含义与train.tsv前9列相同.</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>STS-B数据集的任务类型:<ul>
<li>句子对多分类任务/句子对回归任务</li>
<li>评估指标为: Pearson-Spearman Corr</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<h4 id="qqp">QQP数据集文件样式</h4>
<div class="codehilite" id="__code_30"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_30 pre, #__code_30 code"><span class="md-clipboard__message"></span></button><pre id="__code_31"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_31 pre, #__code_31 code"><span class="md-clipboard__message"></span></button><code><span class="o">-</span> <span class="n">QQP</span><span class="o">/</span>
        <span class="o">-</span> <span class="n">dev</span><span class="p">.</span><span class="n">tsv</span>
        <span class="o">-</span> <span class="n">original</span><span class="o">/</span>
        <span class="o">-</span> <span class="n">test</span><span class="p">.</span><span class="n">tsv</span>
        <span class="o">-</span> <span class="n">train</span><span class="p">.</span><span class="n">tsv</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>文件样式说明:<ul>
<li>在使用中常用到的文件是train.tsv, dev.tsv, test.tsv, 分别代表训练集, 验证集和测试集. 其中train.tsv与dev.tsv数据样式相同, 都是带有标签的数据, 其中test.tsv是不带有标签的数据.</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>train.tsv数据样式:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_32"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_32 pre, #__code_32 code"><span class="md-clipboard__message"></span></button><pre id="__code_33"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_33 pre, #__code_33 code"><span class="md-clipboard__message"></span></button><code>id  qid1    qid2    question1   question2   is_duplicate
133273  213221  213222  How is the life of a math student? Could you describe your own experiences?Which level of prepration is enough for the exam jlpt5?  0
402555  536040  536041  How do I control my horny emotions? How do you control your horniness?  1
360472  364011  490273  What causes stool color to change to yellow?    What can cause stool to come out as little balls?   0
150662  155721  7256    What can one do after MBBS? What do i do after my MBBS ?    1
183004  279958  279959  Where can I find a power outlet for my laptop at Melbourne Airport? Would a second airport in Sydney, Australia be needed if a high-speed rail link was created between Melbourne and Sydney?   0
119056  193387  193388  How not to feel guilty since I am Muslim and I'm conscious we won't have sex together?  I don't beleive I am bulimic, but I force throw up atleast once a day after I eat something and feel guilty. Should I tell somebody, and if so who? 0
356863  422862  96457   How is air traffic controlled?  How do you become an air traffic controller?0
106969  147570  787 What is the best self help book you have read? Why? How did it change your life?    What are the top self help books I should read? 1
...
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>train.tsv数据样式说明:<ul>
<li>train.tsv中的数据内容共分为6列, 第一列代表文本数据索引;  第二列和第三列数据分别代表问题1和问题2的id; 第四列和第五列代表需要进行'是否重复'判定的句子对; 第六列代表上述问题是/不是重复性问题的标签, 0代表不重复, 1代表重复.</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>test.tsv数据样式:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_34"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_34 pre, #__code_34 code"><span class="md-clipboard__message"></span></button><pre id="__code_35"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_35 pre, #__code_35 code"><span class="md-clipboard__message"></span></button><code>id  question1   question2
0   Would the idea of Trump and Putin in bed together scare you, given the geopolitical implications?   Do you think that if Donald Trump were elected President, he would be able to restore relations with Putin and Russia as he said he could, based on the rocky relationship Putin had with Obama and Bush?
1   What are the top ten Consumer-to-Consumer E-commerce online?    What are the top ten Consumer-to-Business E-commerce online?
2   Why don't people simply 'Google' instead of asking questions on Quora?  Why do people ask Quora questions instead of just searching google?
3   Is it safe to invest in social trade biz?   Is social trade geniune?
4   If the universe is expanding then does matter also expand?  If universe and space is expanding? Does that mean anything that occupies space is also expanding?
5   What is the plural of hypothesis?   What is the plural of thesis?
6   What is the application form you need for launching a company?  What is the application form you need for launching a company in Austria?
7   What is Big Theta? When should I use Big Theta as opposed to big O? Is O(Log n) close to O(n) or O(1)?
8   What are the health implications of accidentally eating a small quantity of aluminium foil?What are the implications of not eating vegetables?
...
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>test.tsv数据样式说明:<ul>
<li>test.tsv中的数据内容共分为3列, 第一列数据代表每条文本数据的索引;  第二列和第三列数据代表用于测试的问题句子对.</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>QQP数据集的任务类型:<ul>
<li>句子对二分类任务</li>
<li>评估指标为: ACC/F1</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<h4 id="mnlisnli">(MNLI/SNLI)数据集文件样式</h4>
<div class="codehilite" id="__code_36"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_36 pre, #__code_36 code"><span class="md-clipboard__message"></span></button><pre id="__code_37"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_37 pre, #__code_37 code"><span class="md-clipboard__message"></span></button><code><span class="o">-</span> <span class="p">(</span><span class="n">MNLI</span><span class="o">/</span><span class="n">SNLI</span><span class="p">)</span><span class="o">/</span>
    <span class="o">-</span> <span class="n">dev_matched</span><span class="p">.</span><span class="n">tsv</span>
    <span class="o">-</span> <span class="n">dev_mismatched</span><span class="p">.</span><span class="n">tsv</span>
    <span class="o">-</span> <span class="n">original</span><span class="o">/</span>
    <span class="o">-</span> <span class="n">test_matched</span><span class="p">.</span><span class="n">tsv</span>
    <span class="o">-</span> <span class="n">test_mismatched</span><span class="p">.</span><span class="n">tsv</span>
    <span class="o">-</span> <span class="n">train</span><span class="p">.</span><span class="n">tsv</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>文件样式说明:<ul>
<li>在使用中常用到的文件是train.tsv, dev_matched.tsv, dev_mismatched.tsv, test_matched.tsv, test_mismatched.tsv分别代表训练集, 与训练集一同采集的验证集, 与训练集不是一同采集验证集,  与训练集一同采集的测试集, 与训练集不是一同采集测试集. 其中train.tsv与dev_matched.tsv和dev_mismatched.tsv数据样式相同, 都是带有标签的数据, 其中test_matched.tsv与test_mismatched.tsv数据样式相同, 都是不带有标签的数据.</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>train.tsv数据样式:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_38"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_38 pre, #__code_38 code"><span class="md-clipboard__message"></span></button><pre id="__code_39"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_39 pre, #__code_39 code"><span class="md-clipboard__message"></span></button><code>index   promptID    pairID  genre   sentence1_binary_parse  sentence2_binary_parse  sentence1_parse sentence2_parse sentence1   sentence2   label1  gold_label
0   31193   31193n  government  ( ( Conceptually ( cream skimming ) ) ( ( has ( ( ( two ( basic dimensions ) ) - ) ( ( product and ) geography ) ) ) . ) )  ( ( ( Product and ) geography ) ( ( are ( what ( make ( cream ( skimming work ) ) ) ) ) . ) )   (ROOT (S (NP (JJ Conceptually) (NN cream) (NN skimming)) (VP (VBZ has) (NP (NP (CD two) (JJ basic) (NNS dimensions)) (: -) (NP (NN product) (CC and) (NN geography)))) (. .)))  (ROOT (S (NP (NN Product) (CC and) (NN geography)) (VP (VBP are) (SBAR (WHNP (WP what)) (S (VP (VBP make) (NP (NP (NN cream)) (VP (VBG skimming) (NP (NN work)))))))) (. .)))   Conceptually cream skimming has two basic dimensions - product and geography.   Product and geography are what make cream skimming work.    neutral neutral
1   101457  101457e telephone   ( you ( ( know ( during ( ( ( the season ) and ) ( i guess ) ) ) ) ( at ( at ( ( your level ) ( uh ( you ( ( ( lose them ) ( to ( the ( next level ) ) ) ) ( if ( ( if ( they ( decide ( to ( recall ( the ( the ( parent team ) ) ) ) ) ) ) ) ( ( the Braves ) ( decide ( to ( call ( to ( ( recall ( a guy ) ) ( from ( ( triple A ) ( ( ( then ( ( a ( double ( A guy ) ) ) ( ( goes up ) ( to ( replace him ) ) ) ) ) and ) ( ( a ( single ( A guy ) ) ) ( ( goes up ) ( to ( replace him ) ) ) ) ) ) ) ) ) ) ) ) ) ) ) ) ) ) ) ) ) ) ) ( You ( ( ( ( lose ( the things ) ) ( to ( the ( following level ) ) ) ) ( if ( ( the people ) recall ) ) ) . ) )   (ROOT (S (NP (PRP you)) (VP (VBP know) (PP (IN during) (NP (NP (DT the) (NN season)) (CC and) (NP (FW i) (FW guess)))) (PP (IN at) (IN at) (NP (NP (PRP$ your) (NN level)) (SBAR (S (INTJ (UH uh)) (NP (PRP you)) (VP (VBP lose) (NP (PRP them)) (PP (TO to) (NP (DT the) (JJ next) (NN level))) (SBAR (IN if) (S (SBAR (IN if) (S (NP (PRP they)) (VP (VBP decide) (S (VP (TO to) (VP (VB recall) (NP (DT the) (DT the) (NN parent) (NN team)))))))) (NP (DT the) (NNPS Braves)) (VP (VBP decide) (S (VP (TO to) (VP (VB call) (S (VP (TO to) (VP (VB recall) (NP (DT a) (NN guy)) (PP (IN from) (NP (NP (RB triple) (DT A)) (SBAR (S (S (ADVP (RB then)) (NP (DT a) (JJ double) (NNP A) (NN guy)) (VP (VBZ goes) (PRT (RP up)) (S (VP (TO to) (VP (VB replace) (NP (PRP him))))))) (CC and) (S (NP (DT a) (JJ single) (NNP A) (NN guy)) (VP (VBZ goes) (PRT (RP up)) (S (VP (TO to) (VP (VB replace) (NP (PRP him)))))))))))))))))))))))))))) (ROOT (S (NP (PRP You)) (VP (VBP lose) (NP (DT the) (NNS things)) (PP (TO to) (NP (DT the) (JJ following) (NN level))) (SBAR (IN if) (S (NP (DT the) (NNS people)) (VP (VBP recall))))) (. .))) you know during the season and i guess at at your level uh you lose them to the next level if if they decide to recall the the parent team the Braves decide to call to recall a guy from triple A then a double A guy goes up to replace him and a single A guy goes up to replace him You lose the things to the following level if the people recall.    entailment  entailment
2   134793  134793e fiction ( ( One ( of ( our number ) ) ) ( ( will ( ( ( carry out ) ( your instructions ) ) minutely ) ) . ) )   ( ( ( A member ) ( of ( my team ) ) ) ( ( will ( ( execute ( your orders ) ) ( with ( immense precision ) ) ) ) . ) )   (ROOT (S (NP (NP (CD One)) (PP (IN of) (NP (PRP$ our) (NN number)))) (VP (MD will) (VP (VB carry) (PRT (RP out)) (NP (PRP$ your) (NNS instructions)) (ADVP (RB minutely)))) (. .))) (ROOT (S (NP (NP (DT A) (NN member)) (PP (IN of) (NP (PRP$ my) (NN team)))) (VP (MD will) (VP (VB execute) (NP (PRP$ your) (NNS orders)) (PP (IN with) (NP (JJ immense) (NN precision))))) (. .)))  One of our number will carry out your instructions minutely.    A member of my team will execute your orders with immense precision.    entailment  entailment
3   37397   37397e  fiction ( ( How ( ( ( do you ) know ) ? ) ) ( ( All this ) ( ( ( is ( their information ) ) again ) . ) ) ) ( ( This information ) ( ( belongs ( to them ) ) . ) )  (ROOT (S (SBARQ (WHADVP (WRB How)) (SQ (VBP do) (NP (PRP you)) (VP (VB know))) (. ?)) (NP (PDT All) (DT this)) (VP (VBZ is) (NP (PRP$ their) (NN information)) (ADVP (RB again))) (. .)))   (ROOT (S (NP (DT This) (NN information)) (VP (VBZ belongs) (PP (TO to) (NP (PRP them)))) (. .)))    How do you know? All this is their information again.   This information belongs to them.   entailment  entailment
...
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>train.tsv数据样式说明:<ul>
<li>train.tsv中的数据内容共分为12列, 第一列代表文本数据索引;  第二列和第三列数据分别代表句子对的不同类型id; 第四列代表句子对的来源; 第五列和第六列代表具有句法结构分析的句子对表示; 第七列和第八列代表具有句法结构和词性标注的句子对表示, 第九列和第十列代表原始的句子对, 第十一和第十二列代表不同标准的标注方法产生的标签, 在这里，他们始终相同, 一共有三种类型的标签, neutral代表两个句子既不矛盾也不蕴含, entailment代表两个句子具有蕴含关系, contradiction代表两个句子观点矛盾.</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>test_matched.tsv数据样式:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_40"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_40 pre, #__code_40 code"><span class="md-clipboard__message"></span></button><pre id="__code_41"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_41 pre, #__code_41 code"><span class="md-clipboard__message"></span></button><code>index   promptID    pairID  genre   sentence1_binary_parse  sentence2_binary_parse  sentence1_parse sentence2_parse sentence1   sentence2
0   31493   31493   travel  ( ( ( ( ( ( ( ( Hierbas , ) ( ans seco ) ) , ) ( ans dulce ) ) , ) and ) frigola ) ( ( ( are just ) ( ( a ( few names ) ) ( worth ( ( keeping ( a look-out ) ) for ) ) ) ) . ) )    ( Hierbas ( ( is ( ( a name ) ( worth ( ( looking out ) for ) ) ) ) . ) )   (ROOT (S (NP (NP (NNS Hierbas)) (, ,) (NP (NN ans) (NN seco)) (, ,) (NP (NN ans) (NN dulce)) (, ,) (CC and) (NP (NN frigola))) (VP (VBP are) (ADVP (RB just)) (NP (NP (DT a) (JJ few) (NNS names)) (PP (JJ worth) (S (VP (VBG keeping) (NP (DT a) (NN look-out)) (PP (IN for))))))) (. .))) (ROOT (S (NP (NNS Hierbas)) (VP (VBZ is) (NP (NP (DT a) (NN name)) (PP (JJ worth) (S (VP (VBG looking) (PRT (RP out)) (PP (IN for))))))) (. .)))    Hierbas, ans seco, ans dulce, and frigola are just a few names worth keeping a look-out for.    Hierbas is a name worth looking out for.
1   92164   92164   government  ( ( ( The extent ) ( of ( the ( behavioral effects ) ) ) ) ( ( would ( ( depend ( in ( part ( on ( ( the structure ) ( of ( ( ( the ( individual ( account program ) ) ) and ) ( any limits ) ) ) ) ) ) ) ) ( on ( accessing ( the funds ) ) ) ) ) . ) )    ( ( Many people ) ( ( would ( be ( very ( unhappy ( to ( ( loose control ) ( over ( their ( own money ) ) ) ) ) ) ) ) ) . ) )   (ROOT (S (NP (NP (DT The) (NN extent)) (PP (IN of) (NP (DT the) (JJ behavioral) (NNS effects)))) (VP (MD would) (VP (VB depend) (PP (IN in) (NP (NP (NN part)) (PP (IN on) (NP (NP (DT the) (NN structure)) (PP (IN of) (NP (NP (DT the) (JJ individual) (NN account) (NN program)) (CC and) (NP (DT any) (NNS limits)))))))) (PP (IN on) (S (VP (VBG accessing) (NP (DT the) (NNS funds))))))) (. .))) (ROOT (S (NP (JJ Many) (NNS people)) (VP (MD would) (VP (VB be) (ADJP (RB very) (JJ unhappy) (PP (TO to) (NP (NP (JJ loose) (NN control)) (PP (IN over) (NP (PRP$ their) (JJ own) (NN money)))))))) (. .))) The extent of the behavioral effects would depend in part on the structure of the individual account program and any limits on accessing the funds. Many people would be very unhappy to loose control over their own money.
2   9662    9662    government  ( ( ( Timely access ) ( to information ) ) ( ( is ( in ( ( the ( best interests ) ) ( of ( ( ( both GAO ) and ) ( the agencies ) ) ) ) ) ) . ) )    ( It ( ( ( is ( in ( ( everyone 's ) ( best interest ) ) ) ) ( to ( ( have access ) ( to ( information ( in ( a ( timely manner ) ) ) ) ) ) ) ) . ) )   (ROOT (S (NP (NP (JJ Timely) (NN access)) (PP (TO to) (NP (NN information)))) (VP (VBZ is) (PP (IN in) (NP (NP (DT the) (JJS best) (NNS interests)) (PP (IN of) (NP (NP (DT both) (NNP GAO)) (CC and) (NP (DT the) (NNS agencies))))))) (. .))) (ROOT (S (NP (PRP It)) (VP (VBZ is) (PP (IN in) (NP (NP (NN everyone) (POS 's)) (JJS best) (NN interest))) (S (VP (TO to) (VP (VB have) (NP (NN access)) (PP (TO to) (NP (NP (NN information)) (PP (IN in) (NP (DT a) (JJ timely) (NN manner))))))))) (. .)))   Timely access to information is in the best interests of both GAO and the agencies. It is in everyone's best interest to have access to information in a timely manner.
3   5991    5991    travel  ( ( Based ( in ( ( the ( Auvergnat ( spa town ) ) ) ( of Vichy ) ) ) ) ( , ( ( the ( French government ) ) ( often ( ( ( ( proved ( more zealous ) ) ( than ( its masters ) ) ) ( in ( ( ( suppressing ( civil liberties ) ) and ) ( ( drawing up ) ( anti-Jewish legislation ) ) ) ) ) . ) ) ) ) ) ( ( The ( French government ) ) ( ( passed ( ( anti-Jewish laws ) ( aimed ( at ( helping ( the Nazi ) ) ) ) ) ) . ) )   (ROOT (S (PP (VBN Based) (PP (IN in) (NP (NP (DT the) (NNP Auvergnat) (NN spa) (NN town)) (PP (IN of) (NP (NNP Vichy)))))) (, ,) (NP (DT the) (JJ French) (NN government)) (ADVP (RB often)) (VP (VBD proved) (NP (JJR more) (NNS zealous)) (PP (IN than) (NP (PRP$ its) (NNS masters))) (PP (IN in) (S (VP (VP (VBG suppressing) (NP (JJ civil) (NNS liberties))) (CC and) (VP (VBG drawing) (PRT (RP up)) (NP (JJ anti-Jewish) (NN legislation))))))) (. .))) (ROOT (S (NP (DT The) (JJ French) (NN government)) (VP (VBD passed) (NP (NP (JJ anti-Jewish) (NNS laws)) (VP (VBN aimed) (PP (IN at) (S (VP (VBG helping) (NP (DT the) (JJ Nazi)))))))) (. .))) Based in the Auvergnat spa town of Vichy, the French government often proved more zealous than its masters in suppressing civil liberties and drawing up anti-Jewish legislation.   The French government passed anti-Jewish laws aimed at helping the Nazi.
...
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>test_matched.tsv数据样式说明:<ul>
<li>test_matched.tsv中的数据内容共分为10列, 与train.tsv的前10列含义相同.</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>(MNLI/SNLI)数据集的任务类型:<ul>
<li>句子对多分类任务</li>
<li>评估指标为: ACC</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<h4 id="qnlirtewnli">(QNLI/RTE/WNLI)数据集文件样式</h4>
<div class="codehilite" id="__code_42"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_42 pre, #__code_42 code"><span class="md-clipboard__message"></span></button><pre id="__code_43"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_43 pre, #__code_43 code"><span class="md-clipboard__message"></span></button><code><span class="o">*</span> <span class="n">QNLI</span><span class="p">,</span> <span class="n">RTE</span><span class="p">,</span> <span class="n">WNLI三个数据集的样式基本相同</span><span class="p">.</span>
</code></pre></div>


<div class="codehilite" id="__code_44"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_44 pre, #__code_44 code"><span class="md-clipboard__message"></span></button><pre id="__code_45"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_45 pre, #__code_45 code"><span class="md-clipboard__message"></span></button><code><span class="o">-</span> <span class="p">(</span><span class="n">QNLI</span><span class="o">/</span><span class="n">RTE</span><span class="o">/</span><span class="n">WNLI</span><span class="p">)</span><span class="o">/</span>
        <span class="o">-</span> <span class="n">dev</span><span class="p">.</span><span class="n">tsv</span>
        <span class="o">-</span> <span class="n">test</span><span class="p">.</span><span class="n">tsv</span>
        <span class="o">-</span> <span class="n">train</span><span class="p">.</span><span class="n">tsv</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>文件样式说明:<ul>
<li>在使用中常用到的文件是train.tsv, dev.tsv, test.tsv, 分别代表训练集, 验证集和测试集. 其中train.tsv与dev.tsv数据样式相同, 都是带有标签的数据, 其中test.tsv是不带有标签的数据.</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>QNLI中的train.tsv数据样式:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_46"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_46 pre, #__code_46 code"><span class="md-clipboard__message"></span></button><pre id="__code_47"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_47 pre, #__code_47 code"><span class="md-clipboard__message"></span></button><code>index   question    sentence    label
0   When did the third Digimon series begin?    Unlike the two seasons before it and most of the seasons that followed, Digimon Tamers takes a darker and more realistic approach to its story featuring Digimon who do not reincarnate after their deaths and more complex character development in the original Japanese. not_entailment
1   Which missile batteries often have individual launchers several kilometres from one another?    When MANPADS is operated by specialists, batteries may have several dozen teams deploying separately in small sections; self-propelled air defence guns may deploy in pairs.    not_entailment
2   What two things does Popper argue Tarski's theory involves in an evaluation of truth?   He bases this interpretation on the fact that examples such as the one described above refer to two things: assertions and the facts to which they refer.   entailment
3   What is the name of the village 9 miles north of Calafat where the Ottoman forces attacked the Russians?    On 31 December 1853, the Ottoman forces at Calafat moved against the Russian force at Chetatea or Cetate, a small village nine miles north of Calafat, and engaged them on 6 January 1854.  entailment
4   What famous palace is located in London?    London contains four World Heritage Sites: the Tower of London; Kew Gardens; the site comprising the Palace of Westminster, Westminster Abbey, and St Margaret's Church; and the historic settlement of Greenwich (in which the Royal Observatory, Greenwich marks the Prime Meridian, 0° longitude, and GMT).  not_entailment
5   When is the term 'German dialects' used in regard to the German language?   When talking about the German language, the term German dialects is only used for the traditional regional varieties.   entailment
6   What was the name of the island the English traded to the Dutch in return for New Amsterdam?    At the end of the Second Anglo-Dutch War, the English gained New Amsterdam (New York) in North America in exchange for Dutch control of Run, an Indonesian island.  entailment
7   How were the Portuguese expelled from Myanmar?  From the 1720s onward, the kingdom was beset with repeated Meithei raids into Upper Myanmar and a nagging rebellion in Lan Na.  not_entailment
8   What does the word 'customer' properly apply to?    The bill also required rotation of principal maintenance inspectors and stipulated that the word "customer" properly applies to the flying public, not those entities regulated by the FAA. entailment
...
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>RTE中的train.tsv数据样式:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_48"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_48 pre, #__code_48 code"><span class="md-clipboard__message"></span></button><pre id="__code_49"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_49 pre, #__code_49 code"><span class="md-clipboard__message"></span></button><code>index   sentence1   sentence2   label
0   No Weapons of Mass Destruction Found in Iraq Yet.   Weapons of Mass Destruction Found in Iraq.  not_entailment
1   A place of sorrow, after Pope John Paul II died, became a place of celebration, as Roman Catholic faithful gathered in downtown Chicago to mark the installation of new Pope Benedict XVI.Pope Benedict XVI is the new leader of the Roman Catholic Church. entailment
2   Herceptin was already approved to treat the sickest breast cancer patients, and the company said, Monday, it will discuss with federal regulators the possibility of prescribing the drug for more breast cancer patients.  Herceptin can be used to treat breast cancer.   entailment
3   Judie Vivian, chief executive at ProMedica, a medical service company that helps sustain the 2-year-old Vietnam Heart Institute in Ho Chi Minh City (formerly Saigon), said that so far about 1,500 children have received treatment.   The previous name of Ho Chi Minh City was Saigon.entailment
4   A man is due in court later charged with the murder 26 years ago of a teenager whose case was the first to be featured on BBC One's Crimewatch. Colette Aram, 16, was walking to her boyfriend's house in Keyworth, Nottinghamshire, on 30 October 1983 when she disappeared. Her body was later found in a field close to her home. Paul Stewart Hutchinson, 50, has been charged with murder and is due before Nottingham magistrates later.  Paul Stewart Hutchinson is accused of having stabbed a girl.    not_entailment
5   Britain said, Friday, that it has barred cleric, Omar Bakri, from returning to the country from Lebanon, where he was released by police after being detained for 24 hours. Bakri was briefly detained, but was released.   entailment
6   Nearly 4 million children who have at least one parent who entered the U.S. illegally were born in the United States and are U.S. citizens as a result, according to the study conducted by the Pew Hispanic Center. That's about three quarters of the estimated 5.5 million children of illegal immigrants inside the United States, according to the study. About 1.8 million children of undocumented immigrants live in poverty, the study found.  Three quarters of U.S. illegal immigrants have children.    not_entailment
7   Like the United States, U.N. officials are also dismayed that Aristide killed a conference called by Prime Minister Robert Malval in Port-au-Prince in hopes of bringing all the feuding parties together.  Aristide had Prime Minister Robert Malval  murdered in Port-au-Prince.  not_entailment
8   WASHINGTON --  A newly declassified narrative of the Bush administration's advice to the CIA on harsh interrogations shows that the small group of Justice Department lawyers who wrote memos authorizing controversial interrogation techniques were operating not on their own but with direction from top administration officials, including then-Vice President Dick Cheney and national security adviser Condoleezza Rice. At the same time, the narrative suggests that then-Defense Secretary Donald H. Rumsfeld and then-Secretary of State Colin Powell were largely left out of the decision-making process. Dick Cheney was the Vice President of Bush. entailment
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>WNLI中的train.tsv数据样式:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_50"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_50 pre, #__code_50 code"><span class="md-clipboard__message"></span></button><pre id="__code_51"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_51 pre, #__code_51 code"><span class="md-clipboard__message"></span></button><code>index   sentence1   sentence2   label
0   I stuck a pin through a carrot. When I pulled the pin out, it had a hole.   The carrot had a hole.  1
1   John couldn't see the stage with Billy in front of him because he is so short.  John is so short.   1
2   The police arrested all of the gang members. They were trying to stop the drug trade in the neighborhood.   The police were trying to stop the drug trade in the neighborhood.  1
3   Steve follows Fred's example in everything. He influences him hugely.   Steve influences him hugely.    0
4   When Tatyana reached the cabin, her mother was sleeping. She was careful not to disturb her, undressing and climbing back into her berth.   mother was careful not to disturb her, undressing and climbing back into her berth. 0
5   George got free tickets to the play, but he gave them to Eric, because he was particularly eager to see it. George was particularly eager to see it.    0
6   John was jogging through the park when he saw a man juggling watermelons. He was very impressive.   John was very impressive.   0
7   I couldn't put the pot on the shelf because it was too tall.    The pot was too tall.   1
8   We had hoped to place copies of our newsletter on all the chairs in the auditorium, but there were simply not enough of them.   There were simply not enough copies of the newsletter.  1
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>(QNLI/RTE/WNLI)中的train.tsv数据样式说明:<ul>
<li>train.tsv中的数据内容共分为4列, 第一列代表文本数据索引;  第二列和第三列数据代表需要进行'是否蕴含'判定的句子对; 第四列数据代表两个句子是否具有蕴含关系, 0/not_entailment代表不是蕴含关系, 1/entailment代表蕴含关系.</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>QNLI中的test.tsv数据样式:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_52"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_52 pre, #__code_52 code"><span class="md-clipboard__message"></span></button><pre id="__code_53"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_53 pre, #__code_53 code"><span class="md-clipboard__message"></span></button><code>index   question    sentence
0   What organization is devoted to Jihad against Israel?   For some decades prior to the First Palestine Intifada in 1987, the Muslim Brotherhood in Palestine took a "quiescent" stance towards Israel, focusing on preaching, education and social services, and benefiting from Israel's "indulgence" to build up a network of mosques and charitable organizations.
1   In what century was the Yarrow-Schlick-Tweedy balancing system used?    In the late 19th century, the Yarrow-Schlick-Tweedy balancing 'system' was used on some marine triple expansion engines.
2   The largest brand of what store in the UK is located in Kingston Park?  Close to Newcastle, the largest indoor shopping centre in Europe, the MetroCentre, is located in Gateshead.
3   What does the IPCC rely on for research?    In principle, this means that any significant new evidence or events that change our understanding of climate science between this deadline and publication of an IPCC report cannot be included.
4   What is the principle about relating spin and space variables?  Thus in the case of two fermions there is a strictly negative correlation between spatial and spin variables, whereas for two bosons (e.g. quanta of electromagnetic waves, photons) the correlation is strictly positive.
5   Which network broadcasted Super Bowl 50 in the U.S.?    CBS broadcast Super Bowl 50 in the U.S., and charged an average of $5 million for a 30-second commercial during the game.
6   What did the museum acquire from the Royal College of Science?  To link this to the rest of the museum, a new entrance building was constructed on the site of the former boiler house, the intended site of the Spiral, between 1978 and 1982.
7   What is the name of the old north branch of the Rhine?  From Wijk bij Duurstede, the old north branch of the Rhine is called Kromme Rijn ("Bent Rhine") past Utrecht, first Leidse Rijn ("Rhine of Leiden") and then, Oude Rijn ("Old Rhine").
8   What was one of Luther's most personal writings?    It remains in use today, along with Luther's hymns and his translation of the Bible.
...
</code></pre></div>


<hr>
<ul>
<li>(RTE/WNLI)中的test.tsv数据样式:</li>
</ul>
<div class="codehilite" id="__code_54"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_54 pre, #__code_54 code"><span class="md-clipboard__message"></span></button><pre id="__code_55"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_55 pre, #__code_55 code"><span class="md-clipboard__message"></span></button><code>index   sentence1   sentence2
0   Maude and Dora had seen the trains rushing across the prairie, with long, rolling puffs of black smoke streaming back from the engine. Their roars and their wild, clear whistles could be heard from far away. Horses ran away when they came in sight.    Horses ran away when Maude and Dora came in sight.
1   Maude and Dora had seen the trains rushing across the prairie, with long, rolling puffs of black smoke streaming back from the engine. Their roars and their wild, clear whistles could be heard from far away. Horses ran away when they came in sight.    Horses ran away when the trains came in sight.
2   Maude and Dora had seen the trains rushing across the prairie, with long, rolling puffs of black smoke streaming back from the engine. Their roars and their wild, clear whistles could be heard from far away. Horses ran away when they came in sight.    Horses ran away when the puffs came in sight.
3   Maude and Dora had seen the trains rushing across the prairie, with long, rolling puffs of black smoke streaming back from the engine. Their roars and their wild, clear whistles could be heard from far away. Horses ran away when they came in sight.    Horses ran away when the roars came in sight.
4   Maude and Dora had seen the trains rushing across the prairie, with long, rolling puffs of black smoke streaming back from the engine. Their roars and their wild, clear whistles could be heard from far away. Horses ran away when they came in sight.    Horses ran away when the whistles came in sight.
5   Maude and Dora had seen the trains rushing across the prairie, with long, rolling puffs of black smoke streaming back from the engine. Their roars and their wild, clear whistles could be heard from far away. Horses ran away when they came in sight.    Horses ran away when the horses came in sight.
6   Maude and Dora had seen the trains rushing across the prairie, with long, rolling puffs of black smoke streaming back from the engine. Their roars and their wild, clear whistles could be heard from far away. Horses ran away when they saw a train coming.   Maude and Dora saw a train coming.
7   Maude and Dora had seen the trains rushing across the prairie, with long, rolling puffs of black smoke streaming back from the engine. Their roars and their wild, clear whistles could be heard from far away. Horses ran away when they saw a train coming.   The trains saw a train coming.
8   Maude and Dora had seen the trains rushing across the prairie, with long, rolling puffs of black smoke streaming back from the engine. Their roars and their wild, clear whistles could be heard from far away. Horses ran away when they saw a train coming.   The puffs saw a train coming.
...
</code></pre></div>


<blockquote>
<ul>
<li>(QNLI/RTE/WNLI)中的test.tsv数据样式说明:<ul>
<li>test.tsv中的数据内容共分为3列, 第一列数据代表每条文本数据的索引;  第二列和第三列数据代表需要进行'是否蕴含'判定的句子对.</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li>(QNLI/RTE/WNLI)数据集的任务类型:<ul>
<li>句子对二分类任务</li>
<li>评估指标为: ACC</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<h3 id="_3">小节总结</h3>
<ul>
<li>
<p>学习了GLUE数据集合的介绍:</p>
<ul>
<li>GLUE由纽约大学, 华盛顿大学, Google联合推出, 涵盖不同NLP任务类型, 截止至2020年1月其中包括11个子任务数据集, 成为衡量NLP研究发展的衡量标准.</li>
</ul>
<hr>
</li>
<li>
<p>GLUE数据集合包含以下数据集:</p>
<ul>
<li>CoLA 数据集</li>
<li>SST-2 数据集</li>
<li>MRPC 数据集</li>
<li>STS-B 数据集</li>
<li>QQP 数据集</li>
<li>MNLI 数据集</li>
<li>SNLI 数据集</li>
<li>QNLI 数据集</li>
<li>RTE 数据集</li>
<li>WNLI 数据集</li>
</ul>
</li>
</ul>
<hr>
<h2 id="23-nlp">2.3 NLP中的常用预训练模型</h2>
<hr>
<h3 id="_4">学习目标</h3>
<ul>
<li>了解当下NLP中流行的预训练模型.</li>
<li>掌握如何加载和使用预训练模型.</li>
</ul>
<hr>
<h3 id="nlp">当下NLP中流行的预训练模型</h3>
<ul>
<li>BERT</li>
<li>GPT</li>
<li>GPT-2</li>
<li>Transformer-XL</li>
<li>XLNet</li>
<li>XLM</li>
<li>RoBERTa</li>
<li>DistilBERT</li>
<li>ALBERT </li>
<li>T5</li>
<li>XLM-RoBERTa</li>
</ul>
<hr>
<ul>
<li>BERT及其变体:<ul>
<li>bert-base-uncased: 编码器具有12个隐层, 输出768维张量, 12个自注意力头, 共110M参数量, 在小写的英文文本上进行训练而得到.</li>
<li>bert-large-uncased: 编码器具有24个隐层, 输出1024维张量, 16个自注意力头, 共340M参数量, 在小写的英文文本上进行训练而得到. </li>
<li>bert-base-cased: 编码器具有12个隐层, 输出768维张量, 12个自注意力头, 共110M参数量, 在不区分大小写的英文文本上进行训练而得到.</li>
<li>bert-large-cased: 编码器具有24个隐层, 输出1024维张量, 16个自注意力头, 共340M参数量, 在不区分大小写的英文文本上进行训练而得到.</li>
<li>bert-base-multilingual-uncased: 编码器具有12个隐层, 输出768维张量, 12个自注意力头, 共110M参数量, 在小写的102种语言文本上进行训练而得到.</li>
<li>bert-large-multilingual-uncased: 编码器具有24个隐层, 输出1024维张量, 16个自注意力头, 共340M参数量, 在小写的102种语言文本上进行训练而得到.</li>
<li>bert-base-chinese: 编码器具有12个隐层, 输出768维张量, 12个自注意力头, 共110M参数量, 在简体和繁体中文文本上进行训练而得到.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>GPT:<ul>
<li>openai-gpt: 编码器具有12个隐层, 输出768维张量, 12个自注意力头, 共110M参数量, 由OpenAI在英文语料上进行训练而得到.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>GPT-2及其变体:<ul>
<li>gpt2: 编码器具有12个隐层, 输出768维张量, 12个自注意力头, 共117M参数量, 在OpenAI GPT-2英文语料上进行训练而得到.</li>
<li>gpt2-xl: 编码器具有48个隐层, 输出1600维张量, 25个自注意力头, 共1558M参数量, 在大型的OpenAI GPT-2英文语料上进行训练而得到.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>Transformer-XL:<ul>
<li>transfo-xl-wt103: 编码器具有18个隐层, 输出1024维张量, 16个自注意力头, 共257M参数量, 在wikitext-103英文语料进行训练而得到.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>XLNet及其变体:<ul>
<li>xlnet-base-cased: 编码器具有12个隐层, 输出768维张量, 12个自注意力头, 共110M参数量, 在英文语料上进行训练而得到.</li>
<li>xlnet-large-cased: 编码器具有24个隐层, 输出1024维张量, 16个自注意力头, 共240参数量, 在英文语料上进行训练而得到.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>XLM:<ul>
<li>xlm-mlm-en-2048: 编码器具有12个隐层, 输出2048维张量, 16个自注意力头, 在英文文本上进行训练而得到.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>RoBERTa及其变体:<ul>
<li>roberta-base: 编码器具有12个隐层, 输出768维张量, 12个自注意力头, 共125M参数量, 在英文文本上进行训练而得到.</li>
<li>roberta-large: 编码器具有24个隐层, 输出1024维张量, 16个自注意力头, 共355M参数量, 在英文文本上进行训练而得到.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>DistilBERT及其变体:<ul>
<li>distilbert-base-uncased: 基于bert-base-uncased的蒸馏(压缩)模型, 编码器具有6个隐层, 输出768维张量, 12个自注意力头, 共66M参数量.</li>
<li>distilbert-base-multilingual-cased: 基于bert-base-multilingual-uncased的蒸馏(压缩)模型, 编码器具有6个隐层, 输出768维张量, 12个自注意力头, 共66M参数量.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>ALBERT:<ul>
<li>albert-base-v1: 编码器具有12个隐层, 输出768维张量, 12个自注意力头, 共125M参数量, 在英文文本上进行训练而得到.</li>
<li>albert-base-v2: 编码器具有12个隐层, 输出768维张量, 12个自注意力头, 共125M参数量, 在英文文本上进行训练而得到, 相比v1使用了更多的数据量, 花费更长的训练时间.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>T5及其变体:<ul>
<li>t5-small: 编码器具有6个隐层, 输出512维张量, 8个自注意力头, 共60M参数量, 在C4语料上进行训练而得到.</li>
<li>t5-base: 编码器具有12个隐层, 输出768维张量, 12个自注意力头, 共220M参数量, 在C4语料上进行训练而得到.</li>
<li>t5-large: 编码器具有24个隐层, 输出1024维张量, 16个自注意力头, 共770M参数量, 在C4语料上进行训练而得到.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>XLM-RoBERTa及其变体:<ul>
<li>xlm-roberta-base: 编码器具有12个隐层, 输出768维张量, 8个自注意力头, 共125M参数量, 在2.5TB的100种语言文本上进行训练而得到.</li>
<li>xlm-roberta-large: 编码器具有24个隐层, 输出1027维张量, 16个自注意力头, 共355M参数量, 在2.5TB的100种语言文本上进行训练而得到.</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>预训练模型说明:<ul>
<li>所有上述预训练模型及其变体都是以transformer为基础，只是在模型结构如神经元连接方式，编码器隐层数，多头注意力的头数等发生改变，这些改变方式的大部分依据都是由在标准数据集上的表现而定，因此，对于我们使用者而言，不需要从理论上深度探究这些预训练模型的结构设计的优劣，只需要在自己处理的目标数据上，尽量遍历所有可用的模型对比得到最优效果即可.</li>
</ul>
</li>
</ul>
<hr>
<h3 id="_5">小节总结</h3>
<ul>
<li>当下NLP中流行的预训练模型:<ul>
<li>BERT</li>
<li>GPT</li>
<li>GPT-2</li>
<li>Transformer-XL</li>
<li>XLNet</li>
<li>XLM</li>
<li>RoBERTa</li>
<li>DistilBERT</li>
<li>ALBERT</li>
<li>T5</li>
<li>XLM-RoBERTa</li>
</ul>
</li>
</ul>
<hr>
<h2 id="24">2.4 加载和使用预训练模型</h2>
<hr>
<h3 id="_6">学习目标</h3>
<ul>
<li>了解加载和使用预训练模型的工具.</li>
<li>掌握加载和使用预训练模型的过程.</li>
</ul>
<hr>
<h3 id="_7">加载和使用预训练模型的工具</h3>
<ul>
<li>在这里我们使用torch.hub工具进行模型的加载和使用.</li>
<li>这些预训练模型由世界先进的NLP研发团队huggingface提供.</li>
<li><strong>注意: 下面使用的代码需要国外服务器的资源, 在国内使用的时候, 国内的网站下载可能会出现在原地卡死不动, 或是网络连接超时等一些网络报错, 均是网络问题, 不是代码问题, 这个可以先行跳过, 把主要逻辑梳理完成即可</strong></li>
</ul>
<hr>
<h3 id="_8">加载和使用预训练模型的步骤</h3>
<ul>
<li>第一步: 确定需要加载的预训练模型并安装依赖包.</li>
<li>第二步: 加载预训练模型的映射器tokenizer.</li>
<li>第三步: 加载带/不带头的预训练模型.</li>
<li>第四步: 使用模型获得输出结果.</li>
</ul>
<hr>
<h4 id="_9">第一步: 确定需要加载的预训练模型并安装依赖包</h4>
<ul>
<li>能够加载哪些模型可以参考<a href="http://47.92.175.143:8007/2#23-nlp">2.3 NLP中的常用预训练模型</a></li>
<li>这里假设我们处理的是中文文本任务, 需要加载的模型是BERT的中文模型: bert-base-chinese</li>
<li>在使用工具加载模型前需要安装必备的依赖包:</li>
</ul>
<div class="codehilite" id="__code_56"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_56 pre, #__code_56 code"><span class="md-clipboard__message"></span></button><pre id="__code_57"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_57 pre, #__code_57 code"><span class="md-clipboard__message"></span></button><code>pip install tqdm boto3 requests regex sentencepiece sacremoses
</code></pre></div>


<hr>
<h4 id="tokenizer">第二步: 加载预训练模型的映射器tokenizer</h4>
<div class="codehilite" id="__code_58"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_58 pre, #__code_58 code"><span class="md-clipboard__message"></span></button><pre id="__code_59"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_59 pre, #__code_59 code"><span class="md-clipboard__message"></span></button><code><span class="kn">import</span> <span class="nn">torch</span>

<span class="c1"># 预训练模型来源</span>
<span class="n">source</span> <span class="o">=</span> <span class="s1">'huggingface/pytorch-transformers'</span>
<span class="c1"># 选定加载模型的哪一部分, 这里是模型的映射器</span>
<span class="n">part</span> <span class="o">=</span> <span class="s1">'tokenizer'</span>
<span class="c1"># 加载的预训练模型的名字</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="s1">'bert-base-chinese'</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">hub</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">part</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>  
</code></pre></div>


<hr>
<h4 id="_10">第三步: 加载带/不带头的预训练模型</h4>
<ul>
<li>加载预训练模型时我们可以选择带头或者不带头的模型</li>
<li>这里的'头'是指模型的任务输出层, 选择加载不带头的模型, 相当于使用模型对输入文本进行特征表示.</li>
<li>选择加载带头的模型时, 有三种类型的'头'可供选择, modelWithLMHead(语言模型头), modelForSequenceClassification(分类模型头), modelForQuestionAnswering(问答模型头)</li>
<li>不同类型的'头', 可以使预训练模型输出指定的张量维度. 如使用'分类模型头', 则输出尺寸为(1,2)的张量, 用于进行分类任务判定结果.</li>
</ul>
<div class="codehilite" id="__code_60"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_60 pre, #__code_60 code"><span class="md-clipboard__message"></span></button><pre id="__code_61"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_61 pre, #__code_61 code"><span class="md-clipboard__message"></span></button><code><span class="c1"># 加载不带头的预训练模型</span>
<span class="n">part</span> <span class="o">=</span> <span class="s1">'model'</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">hub</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">part</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>

<span class="c1"># 加载带有语言模型头的预训练模型</span>
<span class="n">part</span> <span class="o">=</span> <span class="s1">'modelWithLMHead'</span>
<span class="n">lm_model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">hub</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">part</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>

<span class="c1"># 加载带有类模型头的预训练模型</span>
<span class="n">part</span> <span class="o">=</span> <span class="s1">'modelForSequenceClassification'</span>
<span class="n">classification_model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">hub</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">part</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>

<span class="c1"># 加载带有问答模型头的预训练模型</span>
<span class="n">part</span> <span class="o">=</span> <span class="s1">'modelForQuestionAnswering'</span>
<span class="n">qa_model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">hub</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">part</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
</code></pre></div>


<hr>
<h4 id="_11">第四步: 使用模型获得输出结果</h4>
<ul>
<li>使用不带头的模型进行输出:</li>
</ul>
<div class="codehilite" id="__code_62"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_62 pre, #__code_62 code"><span class="md-clipboard__message"></span></button><pre id="__code_63"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_63 pre, #__code_63 code"><span class="md-clipboard__message"></span></button><code><span class="c1"># 输入的中文文本</span>
<span class="n">input_text</span> <span class="o">=</span> <span class="s2">"人生该如何起头"</span>

<span class="c1"># 使用tokenizer进行数值映射</span>
<span class="n">indexed_tokens</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">input_text</span><span class="p">)</span>

<span class="c1"># 打印映射后的结构</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"indexed_tokens:"</span><span class="p">,</span> <span class="n">indexed_tokens</span><span class="p">)</span>

<span class="c1"># 将映射结构转化为张量输送给不带头的预训练模型</span>
<span class="n">tokens_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">indexed_tokens</span><span class="p">])</span>

<span class="c1"># 使用不带头的预训练模型获得结果</span>
<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
    <span class="n">encoded_layers</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">tokens_tensor</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s2">"不带头的模型输出结果:"</span><span class="p">,</span> <span class="n">encoded_layers</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s2">"不带头的模型输出结果的尺寸:"</span><span class="p">,</span> <span class="n">encoded_layers</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>输出效果:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_64"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_64 pre, #__code_64 code"><span class="md-clipboard__message"></span></button><pre id="__code_65"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_65 pre, #__code_65 code"><span class="md-clipboard__message"></span></button><code># tokenizer映射后的结果, 101和102是起止符, 
# 中间的每个数字对应"人生该如何起头"的每个字.
indexed_tokens: [101, 782, 4495, 6421, 1963, 862, 6629, 1928, 102]


不带头的模型输出结果: tensor([[[ 0.5421,  0.4526, -0.0179,  ...,  1.0447, -0.1140,  0.0068],
         [-0.1343,  0.2785,  0.1602,  ..., -0.0345, -0.1646, -0.2186],
         [ 0.9960, -0.5121, -0.6229,  ...,  1.4173,  0.5533, -0.2681],
         ...,
         [ 0.0115,  0.2150, -0.0163,  ...,  0.6445,  0.2452, -0.3749],
         [ 0.8649,  0.4337, -0.1867,  ...,  0.7397, -0.2636,  0.2144],
         [-0.6207,  0.1668,  0.1561,  ...,  1.1218, -0.0985, -0.0937]]])


# 输出尺寸为1x9x768, 即每个字已经使用768维的向量进行了表示,
# 我们可以基于此编码结果进行接下来的自定义操作, 如: 编写自己的微调网络进行最终输出.
不带头的模型输出结果的尺寸: torch.Size([1, 9, 768])
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>使用带有语言模型头的模型进行输出:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_66"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_66 pre, #__code_66 code"><span class="md-clipboard__message"></span></button><pre id="__code_67"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_67 pre, #__code_67 code"><span class="md-clipboard__message"></span></button><code><span class="c1"># 使用带有语言模型头的预训练模型获得结果</span>
<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
    <span class="n">lm_output</span> <span class="o">=</span> <span class="n">lm_model</span><span class="p">(</span><span class="n">tokens_tensor</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s2">"带语言模型头的模型输出结果:"</span><span class="p">,</span> <span class="n">lm_output</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s2">"带语言模型头的模型输出结果的尺寸:"</span><span class="p">,</span> <span class="n">lm_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>输出效果:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_68"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_68 pre, #__code_68 code"><span class="md-clipboard__message"></span></button><pre id="__code_69"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_69 pre, #__code_69 code"><span class="md-clipboard__message"></span></button><code>带语言模型头的模型输出结果: (tensor([[[ -7.9706,  -7.9119,  -7.9317,  ...,  -7.2174,  -7.0263,  -7.3746],
         [ -8.2097,  -8.1810,  -8.0645,  ...,  -7.2349,  -6.9283,  -6.9856],
         [-13.7458, -13.5978, -12.6076,  ...,  -7.6817,  -9.5642, -11.9928],
         ...,
         [ -9.0928,  -8.6857,  -8.4648,  ...,  -8.2368,  -7.5684, -10.2419],
         [ -8.9458,  -8.5784,  -8.6325,  ...,  -7.0547,  -5.3288,  -7.8077],
         [ -8.4154,  -8.5217,  -8.5379,  ...,  -6.7102,  -5.9782,  -7.6909]]]),)

# 输出尺寸为1x9x21128, 即每个字已经使用21128维的向量进行了表示, 
# 同不带头的模型一样, 我们可以基于此编码结果进行接下来的自定义操作, 如: 编写自己的微调网络进行最终输出.
带语言模型头的模型输出结果的尺寸: torch.Size([1, 9, 21128])
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>使用带有分类模型头的模型进行输出:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_70"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_70 pre, #__code_70 code"><span class="md-clipboard__message"></span></button><pre id="__code_71"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_71 pre, #__code_71 code"><span class="md-clipboard__message"></span></button><code><span class="c1"># 使用带有分类模型头的预训练模型获得结果</span>
<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
    <span class="n">classification_output</span> <span class="o">=</span> <span class="n">classification_model</span><span class="p">(</span><span class="n">tokens_tensor</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s2">"带分类模型头的模型输出结果:"</span><span class="p">,</span> <span class="n">classification_output</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s2">"带分类模型头的模型输出结果的尺寸:"</span><span class="p">,</span> <span class="n">classification_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>输出效果:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_72"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_72 pre, #__code_72 code"><span class="md-clipboard__message"></span></button><pre id="__code_73"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_73 pre, #__code_73 code"><span class="md-clipboard__message"></span></button><code>带分类模型头的模型输出结果: (tensor([[-0.0649, -0.1593]]),)
# 输出尺寸为1x2, 可直接用于文本二分问题的输出
带分类模型头的模型输出结果的尺寸: torch.Size([1, 2])
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>使用带有问答模型头的模型进行输出:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_74"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_74 pre, #__code_74 code"><span class="md-clipboard__message"></span></button><pre id="__code_75"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_75 pre, #__code_75 code"><span class="md-clipboard__message"></span></button><code><span class="c1"># 使用带有问答模型头的模型进行输出时, 需要使输入的形式为句子对</span>
<span class="c1"># 第一条句子是对客观事物的陈述</span>
<span class="c1"># 第二条句子是针对第一条句子提出的问题</span>
<span class="c1"># 问答模型最终将得到两个张量, </span>
<span class="c1"># 每个张量中最大值对应索引的分别代表答案的在文本中的起始位置和终止位置.</span>
<span class="n">input_text1</span> <span class="o">=</span> <span class="s2">"我家的小狗是黑色的"</span>
<span class="n">input_text2</span> <span class="o">=</span> <span class="s2">"我家的小狗是什么颜色的呢?"</span>


<span class="c1"># 映射两个句子</span>
<span class="n">indexed_tokens</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">input_text1</span><span class="p">,</span> <span class="n">input_text2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"句子对的indexed_tokens:"</span><span class="p">,</span> <span class="n">indexed_tokens</span><span class="p">)</span>

<span class="c1"># 输出结果: [101, 2769, 2157, 4638, 2207, 4318, 3221, 7946, 5682, 4638, 102, 2769, 2157, 4638, 2207, 4318, 3221, 784, 720, 7582, 5682, 4638, 1450, 136, 102]</span>

<span class="c1"># 用0，1来区分第一条和第二条句子</span>
<span class="n">segments_ids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">11</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">14</span>

<span class="c1"># 转化张量形式</span>
<span class="n">segments_tensors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">segments_ids</span><span class="p">])</span>
<span class="n">tokens_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">indexed_tokens</span><span class="p">])</span>

<span class="c1"># 使用带有问答模型头的预训练模型获得结果</span>
<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
    <span class="n">start_logits</span><span class="p">,</span> <span class="n">end_logits</span> <span class="o">=</span> <span class="n">qa_model</span><span class="p">(</span><span class="n">tokens_tensor</span><span class="p">,</span> <span class="n">token_type_ids</span><span class="o">=</span><span class="n">segments_tensors</span><span class="p">)</span>


<span class="k">print</span><span class="p">(</span><span class="s2">"带问答模型头的模型输出结果:"</span><span class="p">,</span> <span class="p">(</span><span class="n">start_logits</span><span class="p">,</span> <span class="n">end_logits</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"带问答模型头的模型输出结果的尺寸:"</span><span class="p">,</span> <span class="p">(</span><span class="n">start_logits</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">end_logits</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>输出效果:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_76"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_76 pre, #__code_76 code"><span class="md-clipboard__message"></span></button><pre id="__code_77"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_77 pre, #__code_77 code"><span class="md-clipboard__message"></span></button><code>句子对的indexed_tokens: [101, 2769, 2157, 4638, 2207, 4318, 3221, 7946, 5682, 4638, 102, 2769, 2157, 4638, 2207, 4318, 3221, 784, 720, 7582, 5682, 4638, 1450, 136, 102]

带问答模型头的模型输出结果: (tensor([[ 0.2574, -0.0293, -0.8337, -0.5135, -0.3645, -0.2216, -0.1625, -0.2768,
         -0.8368, -0.2581,  0.0131, -0.1736, -0.5908, -0.4104, -0.2155, -0.0307,
         -0.1639, -0.2691, -0.4640, -0.1696, -0.4943, -0.0976, -0.6693,  0.2426,
          0.0131]]), tensor([[-0.3788, -0.2393, -0.5264, -0.4911, -0.7277, -0.5425, -0.6280, -0.9800,
         -0.6109, -0.2379, -0.0042, -0.2309, -0.4894, -0.5438, -0.6717, -0.5371,
         -0.1701,  0.0826,  0.1411, -0.1180, -0.4732, -0.1541,  0.2543,  0.2163,
         -0.0042]]))


# 输出为两个形状1x25的张量, 他们是两条句子合并长度的概率分布,
# 第一个张量中最大值所在的索引代表答案出现的起始索引, 
# 第二个张量中最大值所在的索引代表答案出现的终止索引.
带问答模型头的模型输出结果的尺寸: (torch.Size([1, 25]), torch.Size([1, 25]))
</code></pre></div>


<hr>
<h3 id="_12">小节总结</h3>
<ul>
<li>
<p>加载和使用预训练模型的工具:</p>
<ul>
<li>在这里我们使用torch.hub工具进行模型的加载和使用.
这些预训练模型由世界先进的NLP研发团队huggingface提供.</li>
</ul>
<hr>
</li>
<li>
<p>加载和使用预训练模型的步骤:</p>
<ul>
<li>第一步: 确定需要加载的预训练模型并安装依赖包.</li>
<li>第二步: 加载预训练模型的映射器tokenizer.</li>
<li>第三步: 加载带/不带头的预训练模型.</li>
<li>第四步: 使用模型获得输出结果.</li>
</ul>
</li>
</ul>
<hr>
<h2 id="25">2.5 迁移学习实践</h2>
<hr>
<h3 id="_13">学习目标</h3>
<ul>
<li>了解并掌握指定任务类型的微调脚本使用方法.</li>
<li>了解并掌握通过微调脚本微调后模型的使用方法.</li>
<li>掌握通过微调方式进行迁移学习的两种类型实现过程.</li>
</ul>
<hr>
<ul>
<li>指定任务类型的微调脚本:<ul>
<li>huggingface研究机构向我们提供了针对GLUE数据集合任务类型的微调脚本, 这些微调脚本的核心都是微调模型的最后一个全连接层.</li>
<li>通过简单的参数配置来指定GLUE中存在任务类型(如: CoLA对应文本二分类, MRPC对应句子对文本二分类, STS-B对应句子对文本多分类), 以及指定需要微调的预训练模型.</li>
</ul>
</li>
</ul>
<hr>
<h3 id="_14">指定任务类型的微调脚本使用步骤</h3>
<ul>
<li>第一步: 下载微调脚本文件</li>
<li>第二步: 配置微调脚本参数</li>
<li>第三步: 运行并检验效果 </li>
</ul>
<hr>
<h4 id="_15">第一步: 下载微调脚本文件</h4>
<div class="codehilite" id="__code_78"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_78 pre, #__code_78 code"><span class="md-clipboard__message"></span></button><pre id="__code_79"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_79 pre, #__code_79 code"><span class="md-clipboard__message"></span></button><code><span class="c1"># 克隆huggingface的transfomers文件</span>
git clone https://github.com/huggingface/transformers.git

<span class="c1"># 进行transformers文件夹</span>
<span class="nb">cd</span> transformers

<span class="c1"># 安装python的transformer工具包, 因为微调脚本是py文件.</span>
pip install .

<span class="c1"># 当前的版本可能跟我们教学的版本并不相同，你还需要执行：</span>

pip install <span class="nv">transformers</span><span class="o">==</span><span class="m">2</span>.3.0

<span class="c1"># 进入微调脚本所在路径并查看</span>
<span class="nb">cd</span> examples
ls

<span class="c1"># 其中run_glue.py就是针对GLUE数据集合任务类型的微调脚本</span>
</code></pre></div>


<ul>
<li>注意：<ul>
<li>对于run_glue.py，由于版本变更导致，请通过该地址<a href="http://git.itcast.cn/Stephen/AI-key-file/blob/master/run_glue.py">http://git.itcast.cn/Stephen/AI-key-file/blob/master/run_glue.py</a>复制里面的代码，覆盖原有内容。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="_16">第二步: 配置微调脚本参数</h4>
<ul>
<li>在run_glue.py同级目录下创建run_glue.sh文件, 写入内容如下:</li>
</ul>
<div class="codehilite" id="__code_80"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_80 pre, #__code_80 code"><span class="md-clipboard__message"></span></button><pre id="__code_81"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_81 pre, #__code_81 code"><span class="md-clipboard__message"></span></button><code><span class="c1"># 定义DATA_DIR: 微调数据所在路径, 这里我们使用glue_data中的数据作为微调数据</span>
<span class="nb">export</span> <span class="nv">DATA_DIR</span><span class="o">=</span><span class="s2">"../../glue_data"</span>
<span class="c1"># 定义SAVE_DIR: 模型的保存路径, 我们将模型保存在当前目录的bert_finetuning_test文件中</span>
<span class="nb">export</span> <span class="nv">SAVE_DIR</span><span class="o">=</span><span class="s2">"./bert_finetuning_test/"</span>

<span class="c1"># 使用python运行微调脚本</span>
<span class="c1"># --model_type: 选择需要微调的模型类型, 这里可以选择BERT, XLNET, XLM, roBERTa, distilBERT, ALBERT</span>
<span class="c1"># --model_name_or_path: 选择具体的模型或者变体, 这里是在英文语料上微调, 因此选择bert-base-uncased</span>
<span class="c1"># --task_name: 它将代表对应的任务类型, 如MRPC代表句子对二分类任务</span>
<span class="c1"># --do_train: 使用微调脚本进行训练</span>
<span class="c1"># --do_eval: 使用微调脚本进行验证</span>
<span class="c1"># --data_dir: 训练集及其验证集所在路径, 将自动寻找该路径下的train.tsv和dev.tsv作为训练集和验证集</span>
<span class="c1"># --max_seq_length: 输入句子的最大长度, 超过则截断, 不足则补齐</span>
<span class="c1"># --learning_rate: 学习率</span>
<span class="c1"># --num_train_epochs: 训练轮数</span>
<span class="c1"># --output_dir $SAVE_DIR: 训练后的模型保存路径</span>
<span class="c1"># --overwrite_output_dir: 再次训练时将清空之前的保存路径内容重新写入</span>
python run_glue.py <span class="se">\</span>
  --model_type BERT <span class="se">\</span>
  --model_name_or_path bert-base-uncased <span class="se">\</span>
  --task_name MRPC <span class="se">\</span>
  --do_train <span class="se">\</span>
  --do_eval <span class="se">\</span>
  --data_dir <span class="nv">$DATA_DIR</span>/MRPC/ <span class="se">\</span>
  --max_seq_length <span class="m">128</span> <span class="se">\</span>
  --learning_rate 2e-5 <span class="se">\</span>
  --num_train_epochs <span class="m">1</span>.0 <span class="se">\</span>
  --output_dir <span class="nv">$SAVE_DIR</span> <span class="se">\</span>
  --overwrite_output_dir
</code></pre></div>


<hr>
<h4 id="_17">第三步: 运行并检验效果</h4>
<div class="codehilite" id="__code_82"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_82 pre, #__code_82 code"><span class="md-clipboard__message"></span></button><pre id="__code_83"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_83 pre, #__code_83 code"><span class="md-clipboard__message"></span></button><code><span class="c1"># 使用sh命令运行</span>
sh run_glue.sh
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>输出效果:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_84"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_84 pre, #__code_84 code"><span class="md-clipboard__message"></span></button><pre id="__code_85"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_85 pre, #__code_85 code"><span class="md-clipboard__message"></span></button><code># 最终打印模型的验证结果:
01/05/2020 23:59:53 - INFO - __main__ -   Saving features into cached file ../../glue_data/MRPC/cached_dev_bert-base-uncased_128_mrpc
01/05/2020 23:59:53 - INFO - __main__ -   ***** Running evaluation  *****
01/05/2020 23:59:53 - INFO - __main__ -     Num examples = 408
01/05/2020 23:59:53 - INFO - __main__ -     Batch size = 8
Evaluating: 100%|█| 51/51 [00:23&lt;00:00,  2.20it/s]
01/06/2020 00:00:16 - INFO - __main__ -   ***** Eval results  *****
01/06/2020 00:00:16 - INFO - __main__ -     acc = 0.7671568627450981
01/06/2020 00:00:16 - INFO - __main__ -     acc_and_f1 = 0.8073344506341863
01/06/2020 00:00:16 - INFO - __main__ -     f1 = 0.8475120385232745
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>查看$SAVE_DIR的文件内容:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_86"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_86 pre, #__code_86 code"><span class="md-clipboard__message"></span></button><pre id="__code_87"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_87 pre, #__code_87 code"><span class="md-clipboard__message"></span></button><code>added_tokens.json  
checkpoint-450  
checkpoint-400  
checkpoint-350  
checkpoint-200  
checkpoint-300  
checkpoint-250  
checkpoint-200  
checkpoint-150  
checkpoint-100  
checkpoint-50     
pytorch_model.bin        
training_args.bin
config.json       
special_tokens_map.json  
vocab.txt
eval_results.txt  
tokenizer_config.json
</code></pre></div>


<hr>
<ul>
<li>文件解释:<ul>
<li>pytorch_model.bin代表模型参数，可以使用torch.load加载查看；</li>
<li>traning_args.bin代表模型训练时的超参，如batch_size，epoch等，仍可使用torch.load查看；</li>
<li>config.json是模型配置文件，如多头注意力的头数，编码器的层数等，代表典型的模型结构，如bert，xlnet，一般不更改；</li>
<li>added_token.json记录在训练时通过代码添加的自定义token对应的数值，即在代码中使用add_token方法添加的自定义词汇；</li>
<li>special_token_map.json当添加的token具有特殊含义时，如分隔符，该文件存储特殊字符的及其对应的含义，使文本中出现的特殊字符先映射成其含义，之后特殊字符的含义仍然使用add_token方法映射。 </li>
<li>checkpoint: 若干步骤保存的模型参数文件(也叫检测点文件)。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="_18">通过微调脚本微调后模型的使用步骤</h3>
<ul>
<li>第一步: 在<a href="https://huggingface.co/join">https://huggingface.co/join</a>上创建一个帐户</li>
<li>第二步: 在服务器终端使用transformers-cli登陆</li>
<li>第三步: 使用transformers-cli上传模型并查看</li>
<li>第四步: 使用pytorch.hub加载模型进行使用</li>
</ul>
<hr>
<h4 id="httpshuggingfacecojoin">第一步: 在<a href="https://huggingface.co/join">https://huggingface.co/join</a>上创建一个帐户</h4>
<div class="codehilite" id="__code_88"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_88 pre, #__code_88 code"><span class="md-clipboard__message"></span></button><pre id="__code_89"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_89 pre, #__code_89 code"><span class="md-clipboard__message"></span></button><code># 如果由于网络原因无法访问, 我们已经为你提供了默认账户
username: ItcastAI
password: ItcastAI
</code></pre></div>


<p><img alt="avatar" src="./index_files/huggingface.png"></p>
<hr>
<h4 id="transformers-cli">第二步: 在服务器终端使用transformers-cli登陆</h4>
<div class="codehilite" id="__code_90"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_90 pre, #__code_90 code"><span class="md-clipboard__message"></span></button><pre id="__code_91"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_91 pre, #__code_91 code"><span class="md-clipboard__message"></span></button><code><span class="c1"># 在微调模型的服务器上登陆</span>
<span class="c1"># 使用刚刚注册的用户名和密码</span>
<span class="c1"># 默认username: ItcastAI</span>
<span class="c1"># 默认password: ItcastAI</span>
$ transformers-cli login
</code></pre></div>


<hr>
<h4 id="transformers-cli_1">第三步: 使用transformers-cli上传模型并查看</h4>
<div class="codehilite" id="__code_92"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_92 pre, #__code_92 code"><span class="md-clipboard__message"></span></button><pre id="__code_93"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_93 pre, #__code_93 code"><span class="md-clipboard__message"></span></button><code><span class="c1"># 使用transformers-cli upload命令上传模型</span>
<span class="c1"># 选择正确的微调模型路径</span>
$ transformers-cli upload ./bert_finetuning_test/

<span class="c1"># 查看上传结果</span>
$ transformers-cli ls

Filename                                              LastModified             ETag                               Size
----------------------------------------------------- ------------------------ ---------------------------------- ---------
bert_finetuning_test/added_tokens.json                <span class="m">2020</span>-01-05T17:39:57.000Z <span class="s2">"99914b932bd37a50b983c5e7c90ae93b"</span>         <span class="m">2</span>
bert_finetuning_test/checkpoint-400/config.json       <span class="m">2020</span>-01-05T17:26:49.000Z <span class="s2">"74d53ea41e5acb6d60496bc195d82a42"</span>       <span class="m">684</span>
bert_finetuning_test/checkpoint-400/training_args.bin <span class="m">2020</span>-01-05T17:26:47.000Z <span class="s2">"b3273519c2b2b1cb2349937279880f50"</span>      <span class="m">1207</span>
bert_finetuning_test/checkpoint-450/config.json       <span class="m">2020</span>-01-05T17:15:42.000Z <span class="s2">"74d53ea41e5acb6d60496bc195d82a42"</span>       <span class="m">684</span>
bert_finetuning_test/checkpoint-450/pytorch_model.bin <span class="m">2020</span>-01-05T17:15:58.000Z <span class="s2">"077cc0289c90b90d6b662cce104fe4ef"</span> <span class="m">437982584</span>
bert_finetuning_test/checkpoint-450/training_args.bin <span class="m">2020</span>-01-05T17:15:40.000Z <span class="s2">"b3273519c2b2b1cb2349937279880f50"</span>      <span class="m">1207</span>
bert_finetuning_test/config.json                      <span class="m">2020</span>-01-05T17:28:50.000Z <span class="s2">"74d53ea41e5acb6d60496bc195d82a42"</span>       <span class="m">684</span>
bert_finetuning_test/eval_results.txt                 <span class="m">2020</span>-01-05T17:28:56.000Z <span class="s2">"67d2d49a96afc4308d33bfcddda8a7c5"</span>        <span class="m">81</span>
bert_finetuning_test/pytorch_model.bin                <span class="m">2020</span>-01-05T17:28:59.000Z <span class="s2">"d46a8ccfb8f5ba9ecee70cef8306679e"</span> <span class="m">437982584</span>
bert_finetuning_test/special_tokens_map.json          <span class="m">2020</span>-01-05T17:28:54.000Z <span class="s2">"8b3fb1023167bb4ab9d70708eb05f6ec"</span>       <span class="m">112</span>
bert_finetuning_test/tokenizer_config.json            <span class="m">2020</span>-01-05T17:28:52.000Z <span class="s2">"0d7f03e00ecb582be52818743b50e6af"</span>        <span class="m">59</span>
bert_finetuning_test/training_args.bin                <span class="m">2020</span>-01-05T17:28:48.000Z <span class="s2">"b3273519c2b2b1cb2349937279880f50"</span>      <span class="m">1207</span>
bert_finetuning_test/vocab.txt                        <span class="m">2020</span>-01-05T17:39:55.000Z <span class="s2">"64800d5d8528ce344256daf115d4965e"</span>    <span class="m">231508</span>
</code></pre></div>


<hr>
<h4 id="pytorchhub-24">第四步: 使用pytorch.hub加载模型进行使用, 更多信息请参考<a href="http://47.92.175.143:8007/2#24">2.4 加载和使用预训练模型</a></h4>
<div class="codehilite" id="__code_94"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_94 pre, #__code_94 code"><span class="md-clipboard__message"></span></button><pre id="__code_95"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_95 pre, #__code_95 code"><span class="md-clipboard__message"></span></button><code><span class="c1"># 若之前使用过huggingface的transformers, 请清除~/.cache</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="c1"># 如： ItcastAI/bert_finetuning_test</span>
<span class="n">source</span> <span class="o">=</span> <span class="s1">'huggingface/pytorch-transformers'</span>
<span class="c1"># 选定加载模型的哪一部分, 这里是模型的映射器</span>
<span class="n">part</span> <span class="o">=</span> <span class="s1">'tokenizer'</span>

<span class="c1">#############################################</span>
<span class="c1"># 加载的预训练模型的名字</span>
<span class="c1"># 使用自己的模型名字"username/model_name"</span>
<span class="c1"># 如：'ItcastAI/bert_finetuning_test'</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="s1">'ItcastAI/bert_finetuning_test'</span>
<span class="c1">#############################################</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">hub</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">'huggingface/pytorch-transformers'</span><span class="p">,</span> <span class="s1">'tokenizer'</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span>  <span class="n">torch</span><span class="o">.</span><span class="n">hub</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">'huggingface/pytorch-transformers'</span><span class="p">,</span> <span class="s1">'modelForSequenceClassification'</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">"Talk is cheap"</span><span class="p">,</span> <span class="s2">"Please show me your code!"</span><span class="p">)</span>
<span class="c1"># 102是bert模型中的间隔(结束)符号的数值映射</span>
<span class="n">mark</span> <span class="o">=</span> <span class="mi">102</span>

<span class="c1"># 找到第一个102的索引, 即句子对的间隔符号</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">mark</span><span class="p">)</span>

<span class="c1"># 句子对分割id列表, 由0，1组成, 0的位置代表第一个句子, 1的位置代表第二个句子</span>
<span class="n">segments_ids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># 转化为tensor</span>
<span class="n">tokens_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">index</span><span class="p">])</span>
<span class="n">segments_tensors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">segments_ids</span><span class="p">])</span>

<span class="c1"># 使用评估模式</span>
<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
    <span class="c1"># 使用模型预测获得结果</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">tokens_tensor</span><span class="p">,</span> <span class="n">token_type_ids</span><span class="o">=</span><span class="n">segments_tensors</span><span class="p">)</span>
    <span class="c1"># 打印预测结果以及张量尺寸</span>
    <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>输出效果:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_96"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_96 pre, #__code_96 code"><span class="md-clipboard__message"></span></button><pre id="__code_97"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_97 pre, #__code_97 code"><span class="md-clipboard__message"></span></button><code>(tensor([[-0.0181,  0.0263]]),)
torch.Size([1, 2])
</code></pre></div>


<hr>
<h3 id="_19">通过微调方式进行迁移学习的两种类型</h3>
<ul>
<li>类型一: 使用指定任务类型的微调脚本微调预训练模型, 后接带有输出头的预定义网络输出结果.</li>
<li>类型二: 直接加载预训练模型进行输入文本的特征表示, 后接自定义网络进行微调输出结果. </li>
</ul>
<hr>
<ul>
<li>说明: 所有类型的实战演示, 都将针对中文文本进行. </li>
</ul>
<hr>
<h4 id="_20">类型一实战演示</h4>
<ul>
<li>使用文本二分类的任务类型SST-2的微调脚本微调中文预训练模型, 后接带有分类输出头的预定义网络输出结果. 目标是判断句子的情感倾向.</li>
<li>准备中文酒店评论的情感分析语料, 语料样式与SST-2数据集相同, 标签0代表差评, 标签1好评.</li>
<li>语料存放在与glue_data/同级目录cn_data/下, 其中的SST-2目录包含train.tsv和dev.tsv</li>
</ul>
<hr>
<ul>
<li>train.tsv</li>
</ul>
<div class="codehilite" id="__code_98"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_98 pre, #__code_98 code"><span class="md-clipboard__message"></span></button><pre id="__code_99"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_99 pre, #__code_99 code"><span class="md-clipboard__message"></span></button><code>sentence    label
早餐不好,服务不到位,晚餐无西餐,早餐晚餐相同,房间条件不好,餐厅不分吸烟区.房间不分有无烟房.    0
去的时候 ,酒店大厅和餐厅在装修,感觉大厅有点挤.由于餐厅装修本来该享受的早饭,也没有享受(他们是8点开始每个房间送,但是我时间来不及了)不过前台服务员态度好!    1
有很长时间没有在西藏大厦住了，以前去北京在这里住的较多。这次住进来发现换了液晶电视，但网络不是很好，他们自己说是收费的原因造成的。其它还好。  1
非常好的地理位置，住的是豪华海景房，打开窗户就可以看见栈桥和海景。记得很早以前也住过，现在重新装修了。总的来说比较满意，以后还会住   1
交通很方便，房间小了一点，但是干净整洁，很有香港的特色，性价比较高，推荐一下哦 1
酒店的装修比较陈旧，房间的隔音，主要是卫生间的隔音非常差，只能算是一般的    0
酒店有点旧，房间比较小，但酒店的位子不错，就在海边，可以直接去游泳。8楼的海景打开窗户就是海。如果想住在热闹的地带，这里不是一个很好的选择，不过威海城市真的比较小，打车还是相当便宜的。晚上酒店门口出租车比较少。   1
位置很好，走路到文庙、清凉寺5分钟都用不了，周边公交车很多很方便，就是出租车不太爱去（老城区路窄爱堵车），因为是老宾馆所以设施要陈旧些，    1
酒店设备一般，套房里卧室的不能上网，要到客厅去。    0
</code></pre></div>


<hr>
<ul>
<li>dev.tsv</li>
</ul>
<div class="codehilite" id="__code_100"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_100 pre, #__code_100 code"><span class="md-clipboard__message"></span></button><pre id="__code_101"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_101 pre, #__code_101 code"><span class="md-clipboard__message"></span></button><code>sentence    label
房间里有电脑，虽然房间的条件略显简陋，但环境、服务还有饭菜都还是很不错的。如果下次去无锡，我还是会选择这里的。 1
我们是5月1日通过携程网入住的，条件是太差了，根本达不到四星级的标准，所有的东西都很陈旧，卫生间水龙头用完竟关不上，浴缸的漆面都掉了，估计是十年前的四星级吧，总之下次是不会入住了。  0
离火车站很近很方便。住在东楼标间，相比较在九江住的另一家酒店，房间比较大。卫生间设施略旧。服务还好。10元中式早餐也不错，很丰富，居然还有青菜肉片汤。 1
坐落在香港的老城区，可以体验香港居民生活，门口交通很方便，如果时间不紧，坐叮当车很好呀！周围有很多小餐馆，早餐就在中远后面的南北嚼吃的，东西很不错。我们定的大床房，挺安静的，总体来说不错。前台结账没有银联！ 1
酒店前台服务差，对待客人不热情。号称携程没有预定。感觉是客人在求他们，我们一定得住。这样的宾馆下次不会入住！  0
价格确实比较高，而且还没有早餐提供。  1
是一家很实惠的酒店，交通方便，房间也宽敞，晚上没有电话骚扰，住了两次，有一次住５０１房间，洗澡间排水不畅通，也许是个别问题．服务质量很好，刚入住时没有调好宽带，服务员很快就帮忙解决了．    1
位置非常好，就在西街的街口，但是却闹中取静，环境很清新优雅。  1
房间应该超出30平米,是HK同级酒店中少有的大;重装之后,设备也不错. 1
</code></pre></div>


<hr>
<ul>
<li>在run_glue.py同级目录下创建run_cn.sh文件, 写入内容如下:</li>
</ul>
<div class="codehilite" id="__code_102"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_102 pre, #__code_102 code"><span class="md-clipboard__message"></span></button><pre id="__code_103"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_103 pre, #__code_103 code"><span class="md-clipboard__message"></span></button><code><span class="c1"># 定义DATA_DIR: 微调数据所在路径</span>
<span class="nb">export</span> <span class="nv">DATA_DIR</span><span class="o">=</span><span class="s2">"../../cn_data"</span>
<span class="c1"># 定义SAVE_DIR: 模型的保存路径, 我们将模型保存在当前目录的bert_finetuning文件中</span>
<span class="nb">export</span> <span class="nv">SAVE_DIR</span><span class="o">=</span><span class="s2">"./bert_cn_finetuning/"</span>

<span class="c1"># 使用python运行微调脚本</span>
<span class="c1"># --model_type: 选择BERT</span>
<span class="c1"># --model_name_or_path: 选择bert-base-chinese</span>
<span class="c1"># --task_name: 句子二分类任务SST-2</span>
<span class="c1"># --do_train: 使用微调脚本进行训练</span>
<span class="c1"># --do_eval: 使用微调脚本进行验证</span>
<span class="c1"># --data_dir: "./cn_data/SST-2/", 将自动寻找该路径下的train.tsv和dev.tsv作为训练集和验证集</span>
<span class="c1"># --max_seq_length: 128，输入句子的最大长度</span>
<span class="c1"># --output_dir $SAVE_DIR: "./bert_finetuning/", 训练后的模型保存路径</span>
python run_glue.py <span class="se">\</span>
  --model_type BERT <span class="se">\</span>
  --model_name_or_path bert-base-chinese <span class="se">\</span>
  --task_name SST-2 <span class="se">\</span>
  --do_train <span class="se">\</span>
  --do_eval <span class="se">\</span>
  --data_dir <span class="nv">$DATA_DIR</span>/SST-2/ <span class="se">\</span>
  --max_seq_length <span class="m">128</span> <span class="se">\</span>
  --learning_rate 2e-5 <span class="se">\</span>
  --num_train_epochs <span class="m">1</span>.0 <span class="se">\</span>
  --output_dir <span class="nv">$SAVE_DIR</span> <span class="se">\</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>运行并检验效果</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_104"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_104 pre, #__code_104 code"><span class="md-clipboard__message"></span></button><pre id="__code_105"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_105 pre, #__code_105 code"><span class="md-clipboard__message"></span></button><code><span class="c1"># 使用sh命令运行</span>
sh run_cn.sh
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>输出效果:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_106"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_106 pre, #__code_106 code"><span class="md-clipboard__message"></span></button><pre id="__code_107"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_107 pre, #__code_107 code"><span class="md-clipboard__message"></span></button><code># 最终打印模型的验证结果, 准确率高达0.88.
01/06/2020 14:22:36 - INFO - __main__ -   Saving features into cached file ../../cn_data/SST-2/cached_dev_bert-base-chinese_128_sst-2
01/06/2020 14:22:36 - INFO - __main__ -   ***** Running evaluation  *****
01/06/2020 14:22:36 - INFO - __main__ -     Num examples = 1000
01/06/2020 14:22:36 - INFO - __main__ -     Batch size = 8
Evaluating: 100%|████████████| 125/125 [00:56&lt;00:00,  2.20it/s]
01/06/2020 14:23:33 - INFO - __main__ -   ***** Eval results  *****
01/06/2020 14:23:33 - INFO - __main__ -     acc = 0.88
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>查看$SAVE_DIR的文件内容:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_108"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_108 pre, #__code_108 code"><span class="md-clipboard__message"></span></button><pre id="__code_109"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_109 pre, #__code_109 code"><span class="md-clipboard__message"></span></button><code>added_tokens.json
checkpoint-350
checkpoint-200
checkpoint-300
checkpoint-250
checkpoint-200
checkpoint-150
checkpoint-100
checkpoint-50
pytorch_model.bin
training_args.bin
config.json
special_tokens_map.json
vocab.txt
eval_results.txt
tokenizer_config.json
</code></pre></div>


<hr>
<ul>
<li>使用transformers-cli上传模型:</li>
</ul>
<div class="codehilite" id="__code_110"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_110 pre, #__code_110 code"><span class="md-clipboard__message"></span></button><pre id="__code_111"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_111 pre, #__code_111 code"><span class="md-clipboard__message"></span></button><code><span class="c1"># 默认username: ItcastAI</span>
<span class="c1"># 默认password: ItcastAI</span>
$ transformers-cli login

<span class="c1"># 使用transformers-cli upload命令上传模型</span>
<span class="c1"># 选择正确的微调模型路径</span>
$ transformers-cli upload ./bert_cn_finetuning/
</code></pre></div>


<hr>
<ul>
<li>通过pytorch.hub加载模型进行使用:</li>
</ul>
<div class="codehilite" id="__code_112"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_112 pre, #__code_112 code"><span class="md-clipboard__message"></span></button><pre id="__code_113"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_113 pre, #__code_113 code"><span class="md-clipboard__message"></span></button><code><span class="kn">import</span> <span class="nn">torch</span>

<span class="n">source</span> <span class="o">=</span> <span class="s1">'huggingface/pytorch-transformers'</span>
<span class="c1"># 模型名字为'ItcastAI/bert_cn_finetuning'</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="s1">'ItcastAI/bert_cn_finetuning'</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">hub</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s1">'tokenizer'</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span>  <span class="n">torch</span><span class="o">.</span><span class="n">hub</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s1">'modelForSequenceClassification'</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_label</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">tokens_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">index</span><span class="p">])</span>
    <span class="c1"># 使用评估模式</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="c1"># 使用模型预测获得结果</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">tokens_tensor</span><span class="p">)</span>
    <span class="n">predicted_label</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">predicted_label</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="c1"># text = "早餐不好,服务不到位,晚餐无西餐,早餐晚餐相同,房间条件不好"</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">"房间应该超出30平米,是HK同级酒店中少有的大;重装之后,设备也不错."</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"输入文本为:"</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"预测标签为:"</span><span class="p">,</span> <span class="n">get_label</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>输出效果:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_114"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_114 pre, #__code_114 code"><span class="md-clipboard__message"></span></button><pre id="__code_115"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_115 pre, #__code_115 code"><span class="md-clipboard__message"></span></button><code>输入文本为: 早餐不好,服务不到位,晚餐无西餐,早餐晚餐相同,房间条件不好
预测标签为: 0

输入文本为: 房间应该超出30平米,是HK同级酒店中少有的大;重装之后,设备也不错.
预测标签为: 1
</code></pre></div>


<hr>
<h4 id="_21">类型二实战演示</h4>
<ul>
<li>直接加载预训练模型进行输入文本的特征表示, 后接自定义网络进行微调输出结果. </li>
<li>使用语料和完成的目标与类型一实战相同.</li>
</ul>
<hr>
<ul>
<li>直接加载预训练模型进行输入文本的特征表示:</li>
</ul>
<div class="codehilite" id="__code_116"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_116 pre, #__code_116 code"><span class="md-clipboard__message"></span></button><pre id="__code_117"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_117 pre, #__code_117 code"><span class="md-clipboard__message"></span></button><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="c1"># 进行句子的截断补齐(规范长度)</span>
<span class="kn">from</span> <span class="nn">keras.preprocessing</span> <span class="kn">import</span> <span class="n">sequence</span>

<span class="n">source</span> <span class="o">=</span> <span class="s1">'huggingface/pytorch-transformers'</span>

<span class="c1"># 直接使用预训练的bert中文模型</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="s1">'bert-base-chinese'</span>

<span class="c1"># 通过torch.hub获得已经训练好的bert-base-chinese模型</span>
<span class="n">model</span> <span class="o">=</span>  <span class="n">torch</span><span class="o">.</span><span class="n">hub</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s1">'model'</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>

<span class="c1"># 获得对应的字符映射器, 它将把中文的每个字映射成一个数字</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">hub</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s1">'tokenizer'</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>

<span class="c1"># 句子规范长度</span>
<span class="n">cutlen</span> <span class="o">=</span> <span class="mi">32</span>

<span class="k">def</span> <span class="nf">get_bert_encode</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    description: 使用bert-chinese编码中文文本</span>
<span class="sd">    :param text: 要进行编码的文本</span>
<span class="sd">    :return: 使用bert编码后的文本张量表示</span>
<span class="sd">    """</span>
    <span class="c1"># 首先使用字符映射器对每个汉字进行映射</span>
    <span class="c1"># 这里需要注意, bert的tokenizer映射后会为结果前后添加开始和结束标记即101和102 </span>
    <span class="c1"># 这对于多段文本的编码是有意义的, 但在我们这里没有意义, 因此使用[1:-1]对头和尾进行切片</span>
    <span class="n">indexed_tokens</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">text</span><span class="p">[:</span><span class="n">cutlen</span><span class="p">])[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># 对映射后的句子进行截断补齐</span>
    <span class="n">indexed_tokens</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">pad_sequences</span><span class="p">([</span><span class="n">indexed_tokens</span><span class="p">],</span> <span class="n">cutlen</span><span class="p">)</span> 
    <span class="c1"># 之后将列表结构转化为tensor</span>
    <span class="n">tokens_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">(</span><span class="n">indexed_tokens</span><span class="p">)</span>
    <span class="c1"># 使模型不自动计算梯度</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="c1"># 调用模型获得隐层输出</span>
        <span class="n">encoded_layers</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">tokens_tensor</span><span class="p">)</span>
    <span class="c1"># 输出的隐层是一个三维张量, 最外层一维是1, 我们使用[0]降去它.</span>
    <span class="n">encoded_layers</span> <span class="o">=</span> <span class="n">encoded_layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">encoded_layers</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>调用:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_118"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_118 pre, #__code_118 code"><span class="md-clipboard__message"></span></button><pre id="__code_119"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_119 pre, #__code_119 code"><span class="md-clipboard__message"></span></button><code><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">"早餐不好,服务不到位,晚餐无西餐,早餐晚餐相同,房间条件不好"</span>
    <span class="n">encoded_layers</span> <span class="o">=</span> <span class="n">get_bert_encode</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">encoded_layers</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">encoded_layers</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>输出效果:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_120"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_120 pre, #__code_120 code"><span class="md-clipboard__message"></span></button><pre id="__code_121"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_121 pre, #__code_121 code"><span class="md-clipboard__message"></span></button><code>tensor([[-1.2282,  1.0551, -0.7953,  ...,  2.3363, -0.6413,  0.4174],
        [-0.9769,  0.8361, -0.4328,  ...,  2.1668, -0.5845,  0.4836],
        [-0.7990,  0.6181, -0.1424,  ...,  2.2845, -0.6079,  0.5288],
        ...,
        [ 0.9514,  0.5972,  0.3120,  ...,  1.8408, -0.1362, -0.1206],
        [ 0.1250,  0.1984,  0.0484,  ...,  1.2302, -0.1905,  0.3205],
        [ 0.2651,  0.0228,  0.1534,  ...,  1.0159, -0.3544,  0.1479]])

torch.Size([32, 768])
</code></pre></div>


<hr>
<ul>
<li>自定义单层的全连接网络作为微调网络:<ul>
<li>根据实际经验, 自定义的微调网络参数总数应大于0.5倍的训练数据量, 小于10倍的训练数据量, 这样有助于模型在合理的时间范围内收敛.</li>
</ul>
</li>
</ul>
<div class="codehilite" id="__code_122"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_122 pre, #__code_122 code"><span class="md-clipboard__message"></span></button><pre id="__code_123"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_123 pre, #__code_123 code"><span class="md-clipboard__message"></span></button><code><span class="kn">import</span> <span class="nn">torch.nn</span> <span class="kn">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="kn">as</span> <span class="nn">F</span>


<span class="k">class</span> <span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">"""定义微调网络的类"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">embedding_size</span><span class="o">=</span><span class="mi">768</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :param char_size: 输入句子中的字符数量, 即输入句子规范后的长度128.</span>
<span class="sd">        :param embedding_size: 字嵌入的维度, 因为使用的bert中文模型嵌入维度是768, 因此embedding_size为768</span>
<span class="sd">        """</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Net</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># 将char_size和embedding_size传入其中</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">char_size</span> <span class="o">=</span> <span class="n">char_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding_size</span> <span class="o">=</span> <span class="n">embedding_size</span>
        <span class="c1"># 实例化一个全连接层</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">char_size</span><span class="o">*</span><span class="n">embedding_size</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># 对输入的张量形状进行变换, 以满足接下来层的输入要求</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">char_size</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_size</span><span class="p">)</span>
        <span class="c1"># 使用一个全连接层</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>调用:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_124"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_124 pre, #__code_124 code"><span class="md-clipboard__message"></span></button><pre id="__code_125"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_125 pre, #__code_125 code"><span class="md-clipboard__message"></span></button><code><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="c1"># 随机初始化一个输入参数</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">768</span><span class="p">)</span>
    <span class="c1"># 实例化网络结构, 所有参数使用默认值</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">Net</span><span class="p">()</span>
    <span class="n">nr</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">nr</span><span class="p">)</span>    
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>输出效果:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_126"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_126 pre, #__code_126 code"><span class="md-clipboard__message"></span></button><pre id="__code_127"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_127 pre, #__code_127 code"><span class="md-clipboard__message"></span></button><code>tensor([[0.3279, 0.2519]], grad_fn=&lt;ReluBackward0&gt;)
</code></pre></div>


<hr>
<ul>
<li>构建训练与验证数据批次生成器:</li>
</ul>
<div class="codehilite" id="__code_128"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_128 pre, #__code_128 code"><span class="md-clipboard__message"></span></button><pre id="__code_129"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_129 pre, #__code_129 code"><span class="md-clipboard__message"></span></button><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="nb">reduce</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">shuffle</span>

<span class="k">def</span> <span class="nf">data_loader</span><span class="p">(</span><span class="n">train_data_path</span><span class="p">,</span> <span class="n">valid_data_path</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    description: 从持久化文件中加载数据</span>
<span class="sd">    :param train_data_path: 训练数据路径</span>
<span class="sd">    :param valid_data_path: 验证数据路径</span>
<span class="sd">    :param batch_size: 训练和验证数据集的批次大小</span>
<span class="sd">    :return: 训练数据生成器, 验证数据生成器, 训练数据数量, 验证数据数量</span>
<span class="sd">    """</span>
    <span class="c1"># 使用pd进行csv数据的读取, 并去除第一行的列名</span>
    <span class="n">train_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">train_data_path</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">valid_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">valid_data_path</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># 打印训练集和验证集上的正负样本数量</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"训练数据集的正负样本数量:"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">train_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"验证数据集的正负样本数量:"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">valid_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)))</span>

    <span class="c1"># 验证数据集中的数据总数至少能够满足一个批次</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">batch_size</span><span class="p">:</span>
        <span class="k">raise</span><span class="p">(</span><span class="s2">"Batch size or split not match!"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_loader_generator</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        description: 获得训练集/验证集的每个批次数据的生成器</span>
<span class="sd">        :param data: 训练数据或验证数据</span>
<span class="sd">        :return: 一个批次的训练数据或验证数据的生成器</span>
<span class="sd">        """</span>
        <span class="c1"># 以每个批次的间隔遍历数据集</span>
        <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
            <span class="c1"># 定义batch数据的张量列表</span>
            <span class="n">batch_encoded</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">batch_labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># 将一个bitch_size大小的数据转换成列表形式, 并进行逐条遍历</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">())[</span><span class="n">batch</span><span class="p">:</span> <span class="n">batch</span><span class="o">+</span><span class="n">batch_size</span><span class="p">]:</span>
                <span class="c1"># 使用bert中文模型进行编码</span>
                <span class="n">encoded</span> <span class="o">=</span> <span class="n">get_bert_encode</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="c1"># 将编码后的每条数据装进预先定义好的列表中</span>
                <span class="n">batch_encoded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span>
                <span class="c1"># 同样将对应的该batch的标签装进labels列表中</span>
                <span class="n">batch_labels</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
            <span class="c1"># 使用reduce高阶函数将列表中的数据转换成模型需要的张量形式</span>
            <span class="c1"># encoded的形状是(batch_size*max_len, embedding_size)</span>
            <span class="n">encoded</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">batch_encoded</span><span class="p">)</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="n">batch_labels</span><span class="p">))</span>
            <span class="c1"># 以生成器的方式返回数据和标签</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">encoded</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

    <span class="c1"># 对训练集和验证集分别使用_loader_generator函数, 返回对应的生成器</span>
    <span class="c1"># 最后还要返回训练集和验证集的样本数量</span>
    <span class="k">return</span> <span class="n">_loader_generator</span><span class="p">(</span><span class="n">train_data</span><span class="p">),</span> <span class="n">_loader_generator</span><span class="p">(</span><span class="n">valid_data</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_data</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_data</span><span class="p">)</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>调用:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_130"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_130 pre, #__code_130 code"><span class="md-clipboard__message"></span></button><pre id="__code_131"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_131 pre, #__code_131 code"><span class="md-clipboard__message"></span></button><code><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">train_data_path</span> <span class="o">=</span> <span class="s2">"./cn_data/SST-2/train.tsv"</span>
    <span class="n">valid_data_path</span> <span class="o">=</span> <span class="s2">"./cn_data/SST-2/dev.tsv"</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">train_data_labels</span><span class="p">,</span> <span class="n">valid_data_labels</span><span class="p">,</span> \
    <span class="n">train_data_len</span><span class="p">,</span> <span class="n">valid_data_len</span> <span class="o">=</span> <span class="n">data_loader</span><span class="p">(</span><span class="n">train_data_path</span><span class="p">,</span> <span class="n">valid_data_path</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">train_data_labels</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">valid_data_labels</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"train_data_len:"</span><span class="p">,</span> <span class="n">train_data_len</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"valid_data_len:"</span><span class="p">,</span> <span class="n">valid_data_len</span><span class="p">)</span>
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>输出效果:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_132"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_132 pre, #__code_132 code"><span class="md-clipboard__message"></span></button><pre id="__code_133"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_133 pre, #__code_133 code"><span class="md-clipboard__message"></span></button><code>训练数据集的正负样本数量:
{'0': 1518, '1': 1442}
验证数据集的正负样本数量:
{'1': 518, '0': 482}
(tensor([[[-0.8328,  0.9376, -1.2489,  ...,  1.8594, -0.4636, -0.1682],
        [-0.9798,  0.5113, -0.9868,  ...,  1.5500, -0.1934,  0.2521],
        [-0.7574,  0.3086, -0.6031,  ...,  1.8467, -0.2507,  0.3916],
        ...,
        [ 0.0064,  0.2321,  0.3785,  ...,  0.3376,  0.4748, -0.1272],
        [-0.3175,  0.4018, -0.0377,  ...,  0.6030,  0.2916, -0.4172],
        [-0.6154,  1.0439,  0.2921,  ...,  0.5048, -0.0983,  0.0061]]]), tensor([0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0,
        1, 0, 1, 1, 1, 1, 0, 0]))
(tensor([[[-0.1611,  0.9182, -0.3419,  ...,  0.6323, -0.2013,  0.0184],
        [-0.1224,  0.7706, -0.2386,  ...,  0.7925,  0.0444,  0.2160],
        [-0.0301,  0.6867, -0.1510,  ...,  0.9140,  0.0308,  0.2611],
        ...,
        [ 0.3662, -0.4925,  1.2332,  ...,  0.7741, -0.1007, -0.3099],
        [-0.0932, -0.8494,  0.6586,  ...,  0.1235, -0.3152, -0.1635],
        [ 0.5306, -0.5510,  0.3105,  ...,  1.2631, -0.5882, -0.1133]]]), tensor([1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,
        1, 0, 0, 1, 1, 1, 0, 0]))
train_data_len: 2960
valid_data_len: 1000
</code></pre></div>


<hr>
<ul>
<li>编写训练和验证函数:</li>
</ul>
<div class="codehilite" id="__code_134"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_134 pre, #__code_134 code"><span class="md-clipboard__message"></span></button><pre id="__code_135"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_135 pre, #__code_135 code"><span class="md-clipboard__message"></span></button><code><span class="kn">import</span> <span class="nn">torch.optim</span> <span class="kn">as</span> <span class="nn">optim</span>

<span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">train_data_labels</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    description: 训练函数, 在这个过程中将更新模型参数, 并收集准确率和损失</span>
<span class="sd">    :param train_data_labels: 训练数据和标签的生成器对象</span>
<span class="sd">    :return: 整个训练过程的平均损失之和以及正确标签的累加数</span>
<span class="sd">    """</span>
    <span class="c1"># 定义训练过程的初始损失和准确率累加数</span>
    <span class="n">train_running_loss</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">train_running_acc</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># 循环遍历训练数据和标签生成器, 每个批次更新一次模型参数</span>
    <span class="k">for</span> <span class="n">train_tensor</span><span class="p">,</span> <span class="n">train_labels</span> <span class="ow">in</span> <span class="n">train_data_labels</span><span class="p">:</span>
        <span class="c1"># 初始化该批次的优化器</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="c1"># 使用微调网络获得输出</span>
        <span class="n">train_outputs</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">train_tensor</span><span class="p">)</span>
        <span class="c1"># 得到该批次下的平均损失</span>
        <span class="n">train_loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">train_outputs</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
        <span class="c1"># 将该批次的平均损失加到train_running_loss中</span>
        <span class="n">train_running_loss</span> <span class="o">+=</span> <span class="n">train_loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="c1"># 损失反向传播</span>
        <span class="n">train_loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="c1"># 优化器更新模型参数</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="c1"># 将该批次中正确的标签数量进行累加, 以便之后计算准确率</span>
        <span class="n">train_running_acc</span> <span class="o">+=</span> <span class="p">(</span><span class="n">train_outputs</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">train_labels</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">train_running_loss</span><span class="p">,</span> <span class="n">train_running_acc</span>


<span class="k">def</span> <span class="nf">valid</span><span class="p">(</span><span class="n">valid_data_labels</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    description: 验证函数, 在这个过程中将验证模型的在新数据集上的标签, 收集损失和准确率</span>
<span class="sd">    :param valid_data_labels: 验证数据和标签的生成器对象</span>
<span class="sd">    :return: 整个验证过程的平均损失之和以及正确标签的累加数</span>
<span class="sd">    """</span>
    <span class="c1"># 定义训练过程的初始损失和准确率累加数</span>
    <span class="n">valid_running_loss</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">valid_running_acc</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># 循环遍历验证数据和标签生成器</span>
    <span class="k">for</span> <span class="n">valid_tensor</span><span class="p">,</span> <span class="n">valid_labels</span> <span class="ow">in</span> <span class="n">valid_data_labels</span><span class="p">:</span>
        <span class="c1"># 不自动更新梯度</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="c1"># 使用微调网络获得输出</span>
            <span class="n">valid_outputs</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">valid_tensor</span><span class="p">)</span>
            <span class="c1"># 得到该批次下的平均损失</span>
            <span class="n">valid_loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">valid_outputs</span><span class="p">,</span> <span class="n">valid_labels</span><span class="p">)</span>
            <span class="c1"># 将该批次的平均损失加到valid_running_loss中</span>
            <span class="n">valid_running_loss</span> <span class="o">+=</span> <span class="n">valid_loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="c1"># 将该批次中正确的标签数量进行累加, 以便之后计算准确率</span>
            <span class="n">valid_running_acc</span> <span class="o">+=</span> <span class="p">(</span><span class="n">valid_outputs</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">valid_labels</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">valid_running_loss</span><span class="p">,</span>  <span class="n">valid_running_acc</span>
</code></pre></div>


<blockquote>
<ul>
<li>调用并保存模型:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_136"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_136 pre, #__code_136 code"><span class="md-clipboard__message"></span></button><pre id="__code_137"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_137 pre, #__code_137 code"><span class="md-clipboard__message"></span></button><code><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="c1"># 设定数据路径</span>
    <span class="n">train_data_path</span> <span class="o">=</span> <span class="s2">"./cn_data/SST-2/train.tsv"</span>
    <span class="n">valid_data_path</span> <span class="o">=</span> <span class="s2">"./cn_data/SST-2/dev.tsv"</span>
    <span class="c1"># 定义交叉熵损失函数</span>
    <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
    <span class="c1"># 定义SGD优化方法</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
    <span class="c1"># 定义训练轮数</span>
    <span class="n">epochs</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="c1"># 定义批次样本数量</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="c1"># 进行指定轮次的训练</span>
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
        <span class="c1"># 打印轮次</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">"Epoch:"</span><span class="p">,</span> <span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># 通过数据加载器获得训练数据和验证数据生成器, 以及对应的样本数量</span>
        <span class="n">train_data_labels</span><span class="p">,</span> <span class="n">valid_data_labels</span><span class="p">,</span> <span class="n">train_data_len</span><span class="p">,</span> \
        <span class="n">valid_data_len</span> <span class="o">=</span> <span class="n">data_loader</span><span class="p">(</span><span class="n">train_data_path</span><span class="p">,</span> <span class="n">valid_data_path</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
        <span class="c1"># 调用训练函数进行训练</span>
        <span class="n">train_running_loss</span><span class="p">,</span> <span class="n">train_running_acc</span> <span class="o">=</span> <span class="n">train</span><span class="p">(</span><span class="n">train_data_labels</span><span class="p">)</span>
        <span class="c1"># 调用验证函数进行验证</span>
        <span class="n">valid_running_loss</span><span class="p">,</span> <span class="n">valid_running_acc</span> <span class="o">=</span> <span class="n">valid</span><span class="p">(</span><span class="n">valid_data_labels</span><span class="p">)</span>
        <span class="c1"># 计算每一轮的平均损失, train_running_loss和valid_running_loss是每个批次的平均损失之和</span>
        <span class="c1"># 因此将它们乘以batch_size就得到了该轮的总损失, 除以样本数即该轮次的平均损失</span>
        <span class="n">train_average_loss</span> <span class="o">=</span> <span class="n">train_running_loss</span> <span class="o">*</span> <span class="n">batch_size</span> <span class="o">/</span> <span class="n">train_data_len</span>
        <span class="n">valid_average_loss</span> <span class="o">=</span> <span class="n">valid_running_loss</span> <span class="o">*</span> <span class="n">batch_size</span> <span class="o">/</span> <span class="n">valid_data_len</span>

        <span class="c1"># train_running_acc和valid_running_acc是每个批次的正确标签累加和,</span>
        <span class="c1"># 因此只需除以对应样本总数即是该轮次的准确率</span>
        <span class="n">train_average_acc</span> <span class="o">=</span> <span class="n">train_running_acc</span> <span class="o">/</span>  <span class="n">train_data_len</span>
        <span class="n">valid_average_acc</span> <span class="o">=</span> <span class="n">valid_running_acc</span> <span class="o">/</span> <span class="n">valid_data_len</span>
        <span class="c1"># 打印该轮次下的训练损失和准确率以及验证损失和准确率</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">"Train Loss:"</span><span class="p">,</span> <span class="n">train_average_loss</span><span class="p">,</span> <span class="s2">"|"</span><span class="p">,</span> <span class="s2">"Train Acc:"</span><span class="p">,</span> <span class="n">train_average_acc</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">"Valid Loss:"</span><span class="p">,</span> <span class="n">valid_average_loss</span><span class="p">,</span> <span class="s2">"|"</span><span class="p">,</span> <span class="s2">"Valid Acc:"</span><span class="p">,</span> <span class="n">valid_average_acc</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">'Finished Training'</span><span class="p">)</span>

    <span class="c1"># 保存路径</span>
    <span class="n">MODEL_PATH</span> <span class="o">=</span> <span class="s1">'./BERT_net.pth'</span>
    <span class="c1"># 保存模型参数</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="n">MODEL_PATH</span><span class="p">)</span> 
    <span class="k">print</span><span class="p">(</span><span class="s1">'Finished Saving'</span><span class="p">)</span>    
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>输出效果:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_138"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_138 pre, #__code_138 code"><span class="md-clipboard__message"></span></button><pre id="__code_139"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_139 pre, #__code_139 code"><span class="md-clipboard__message"></span></button><code>Epoch: 1
Train Loss: 2.144986984236597 | Train Acc: 0.7347972972972973
Valid Loss: 2.1898122818128902 | Valid Acc: 0.704
Epoch: 2
Train Loss: 1.3592962406135032 | Train Acc: 0.8435810810810811
Valid Loss: 1.8816152956699324 | Valid Acc: 0.784
Epoch: 3
Train Loss: 1.5507876996199943 | Train Acc: 0.8439189189189189
Valid Loss: 1.8626576719331536 | Valid Acc: 0.795
Epoch: 4
Train Loss: 0.7825378059198299 | Train Acc: 0.9081081081081082
Valid Loss: 2.121698483480899 | Valid Acc: 0.803
Finished Training
Finished Saving
</code></pre></div>


<hr>
<blockquote>
<ul>
<li>加载模型进行使用:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_140"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_140 pre, #__code_140 code"><span class="md-clipboard__message"></span></button><pre id="__code_141"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_141 pre, #__code_141 code"><span class="md-clipboard__message"></span></button><code><span class="k">if</span> <span class="nv">__name__</span> <span class="o">==</span> <span class="s2">"</span><span class="s">__main__</span><span class="s2">"</span>:
    <span class="nv">MODEL_PATH</span> <span class="o">=</span> <span class="s1">'</span><span class="s">./BERT_net.pth</span><span class="s1">'</span>
    # 加载模型参数
    <span class="nv">net</span>.<span class="nv">load_state_dict</span><span class="ss">(</span><span class="nv">torch</span>.<span class="nv">load</span><span class="ss">(</span><span class="nv">MODEL_PATH</span><span class="ss">))</span>

    # <span class="nv">text</span> <span class="o">=</span> <span class="s2">"</span><span class="s">酒店设备一般，套房里卧室的不能上网，要到客厅去。</span><span class="s2">"</span>
    <span class="nv">text</span> <span class="o">=</span> <span class="s2">"</span><span class="s">房间应该超出30平米,是HK同级酒店中少有的大;重装之后,设备也不错.</span><span class="s2">"</span>
    <span class="nv">print</span><span class="ss">(</span><span class="s2">"</span><span class="s">输入文本为:</span><span class="s2">"</span>, <span class="nv">text</span><span class="ss">)</span>
    <span class="nv">with</span> <span class="nv">torch</span>.<span class="nv">no_grad</span><span class="ss">()</span>:
        <span class="nv">output</span> <span class="o">=</span> <span class="nv">net</span><span class="ss">(</span><span class="nv">get_bert_encode</span><span class="ss">(</span><span class="nv">text</span><span class="ss">))</span>
        # 从<span class="nv">output</span>中取出最大值对应的索引
        <span class="nv">print</span><span class="ss">(</span><span class="s2">"</span><span class="s">预测标签为:</span><span class="s2">"</span>, <span class="nv">torch</span>.<span class="nv">argmax</span><span class="ss">(</span><span class="nv">output</span><span class="ss">)</span>.<span class="nv">item</span><span class="ss">())</span>
</code></pre></div>


<blockquote>
<ul>
<li>输出效果:</li>
</ul>
</blockquote>
<div class="codehilite" id="__code_142"><button class="md-clipboard" title="复制" data-clipboard-target="#__code_142 pre, #__code_142 code"><span class="md-clipboard__message"></span></button><pre id="__code_143"><span></span><button class="md-clipboard" title="复制" data-clipboard-target="#__code_143 pre, #__code_143 code"><span class="md-clipboard__message"></span></button><code>输入文本为: 房间应该超出30平米,是HK同级酒店中少有的大;重装之后,设备也不错.
预测标签为: 1
输入文本为: 酒店设备一般，套房里卧室的不能上网，要到客厅去。
预测标签为: 0
</code></pre></div>


<hr>
<h3 id="_22">小节总结</h3>
<ul>
<li>
<p>学习了指定任务类型的微调脚本:</p>
<ul>
<li>huggingface研究机构向我们提供了针对GLUE数据集合任务类型的微调脚本, 这些微调脚本的核心都是微调模型的最后一个全连接层.</li>
<li>通过简单的参数配置来指定GLUE中存在任务类型(如: CoLA对应文本二分类, MRPC对应句子对文本二分类, STS-B对应句子对文本多分类), 以及指定需要微调的预训练模型.</li>
</ul>
<hr>
</li>
<li>
<p>学习了指定任务类型的微调脚本使用步骤:</p>
<ul>
<li>第一步: 下载微调脚本文件</li>
<li>第二步: 配置微调脚本参数</li>
<li>第三步: 运行并检验效果</li>
</ul>
<hr>
</li>
<li>
<p>学习了通过微调脚本微调后模型的使用步骤:</p>
<ul>
<li>第一步: 在https://huggingface.co/join上创建一个帐户</li>
<li>第二步: 在服务器终端使用transformers-cli登陆</li>
<li>第三步: 使用transformers-cli上传模型并查看</li>
<li>第四步: 使用pytorch.hub加载模型进行使用</li>
</ul>
<hr>
</li>
<li>
<p>学习了通过微调方式进行迁移学习的两种类型:</p>
<ul>
<li>类型一: 使用指定任务类型的微调脚本微调预训练模型, 后接带有输出头的预定义网络输出结果.</li>
<li>类型二: 直接加载预训练模型进行输入文本的特征表示, 后接自定义网络进行微调输出结果.</li>
</ul>
<hr>
</li>
<li>
<p>学习了类型一实战演示:</p>
<ul>
<li>使用文本二分类的任务类型SST-2的微调脚本微调中文预训练模型, 后接带有分类输出头的预定义网络输出结果. 目标是判断句子的情感倾向.</li>
<li>准备中文酒店评论的情感分析语料, 语料样式与SST-2数据集相同, 标签0代表差评, 标签1好评.</li>
<li>语料存放在与glue_data/同级目录cn_data/下, 其中的SST-2目录包含train.tsv和dev.tsv</li>
</ul>
<hr>
</li>
<li>
<p>学习了类型二实战演示:</p>
<ul>
<li>直接加载预训练模型进行输入文本的特征表示, 后接自定义网络进行微调输出结果.</li>
</ul>
</li>
</ul>
<hr>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="./index.html" title="第一章:fasttext工具的使用" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  上一页
                </span>
                第一章:fasttext工具的使用
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            ©Copyright 2019, itcast.cn.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org/">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="./index_files/font-awesome.css">
    
      <a href="https://www.linkedin.com/in/%E7%A7%91%E6%8A%80%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8-%E5%8C%97%E4%BA%AC%E6%A9%98%E6%98%9F-6bb7081a1/" class="md-footer-social__link fa fa-linkedin"></a>
    
      <a href="https://weibo.com/u/3469990762?is_all=1" class="md-footer-social__link fa fa-weibo"></a>
    
      <a href="http://bitbucket.org/AITutorials" class="md-footer-social__link fa fa-bitbucket"></a>
    
      <a href="https://github.com/AITutorials/datasets/issues" class="md-footer-social__link fa fa-gitlab"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="./index_files/application.245445c6.js"></script>
      
        
        
          
          <script src="./index_files/lunr.stemmer.support.js"></script>
          
            
              
                <script src="./index_files/tinyseg.js"></script>
              
              
                <script src="./index_files/lunr.ja.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.1.2",url:{base:".."}})</script>
      
    
  
</body></html>